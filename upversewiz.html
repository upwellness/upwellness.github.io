<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MTA Gold Commander V.15.5 (Focus Button)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Lightweight Charts (Stable V4.1.1) -->
    <script src="https://unpkg.com/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Sarabun:wght@300;400;600;800&display=swap');
        body { font-family: 'Sarabun', sans-serif; background-color: #050505; color: #e5e7eb; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #111; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, forwardRef, useImperativeHandle } = React;

        // --- 1. ICONS (Safe Components) ---
        const Icon = ({ children, size = 18, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Icons = {
            Zap: (p) => <Icon {...p}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" /></Icon>,
            History: (p) => <Icon {...p}><path d="M3 3v5h5" /><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8" /><path d="M12 7v5l4 2" /></Icon>,
            Camera: (p) => <Icon {...p}><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z" /><circle cx="12" cy="13" r="4" /></Icon>,
            X: (p) => <Icon {...p}><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></Icon>,
            Edit: (p) => <Icon {...p}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" /><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" /></Icon>,
            Check: (p) => <Icon {...p}><polyline points="20 6 9 17 4 12" /></Icon>,
            Copy: (p) => <Icon {...p}><rect x="9" y="9" width="13" height="13" rx="2" ry="2" /><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" /></Icon>,
            FileText: (p) => <Icon {...p}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" /><polyline points="14 2 14 8 20 8" /><line x1="16" y1="13" x2="8" y2="13" /><line x1="16" y1="17" x2="8" y2="17" /><polyline points="10 9 9 9 8 9" /></Icon>,
            ChevronDown: (p) => <Icon {...p}><polyline points="6 9 12 15 18 9" /></Icon>,
            Table: (p) => <Icon {...p}><path d="M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18" /></Icon>,
            TrendingUp: (p) => <Icon {...p}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18" /><polyline points="17 6 23 6 23 12" /></Icon>,
            TrendingDown: (p) => <Icon {...p}><polyline points="23 18 13.5 8.5 8.5 13.5 1 6" /><polyline points="17 18 23 18 23 12" /></Icon>,
            Focus: (p) => <Icon {...p}><circle cx="12" cy="12" r="3" /><path d="M6 12h-4" /><path d="M22 12h-4" /><path d="M12 6v-4" /><path d="M12 22v-4" /></Icon>
        };

        // --- 2. SCHEMATIC COMPONENT ---
        const MTAChartSimulator = ({ bias, zonePrice, width = "100%", height = 120 }) => {
            const isBullish = bias === 'BULLISH';
            const color = isBullish ? "#22c55e" : "#ef4444";
            const zoneY = isBullish ? 90 : 30;
            
            return (
                <div className="w-full h-full bg-gray-900 rounded-lg relative overflow-hidden border border-gray-700">
                    <svg width="100%" height="100%" viewBox="0 0 300 120" preserveAspectRatio="none">
                        <defs>
                            <linearGradient id={`grad${isBullish?'G':'R'}`} x1="0" y1="0" x2="0" y2="1">
                                <stop offset="0%" stopColor={color} stopOpacity="0.3" />
                                <stop offset="100%" stopColor={color} stopOpacity="0" />
                            </linearGradient>
                            <marker id="arrow" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
                                <path d="M0,0 L0,6 L6,3 z" fill={color} />
                            </marker>
                        </defs>

                        <line x1="0" y1="30" x2="300" y2="30" stroke="#333" strokeWidth="0.5" strokeDasharray="4 4"/>
                        <line x1="0" y1="60" x2="300" y2="60" stroke="#333" strokeWidth="0.5" strokeDasharray="4 4"/>
                        <line x1="0" y1="90" x2="300" y2="90" stroke="#333" strokeWidth="0.5" strokeDasharray="4 4"/>

                        <rect x="0" y={isBullish ? 80 : 10} width="300" height="30" fill={`url(#grad${isBullish?'G':'R'})`} />
                        <line x1="0" y1={zoneY} x2="300" y2={zoneY} stroke={color} strokeWidth="2" strokeDasharray="4 2"/>
                        
                        <text x="290" y={isBullish ? 105 : 35} fill={color} fontSize="12" textAnchor="end" fontWeight="bold">
                            {isBullish ? 'DEMAND ZONE' : 'SUPPLY ZONE'}
                        </text>

                        {isBullish ? (
                            <>
                                <path d="M 20 20 L 100 90" stroke="#ef4444" strokeWidth="1.5" strokeDasharray="4 2" opacity="0.5" />
                                <path d="M 100 90 Q 140 120 180 60 L 260 20" fill="none" stroke={color} strokeWidth="3" markerEnd="url(#arrow)" />
                                <circle cx="100" cy="90" r="4" fill={color} />
                                <text x="100" y="115" fill={color} fontSize="10" textAnchor="middle" fontWeight="bold">WAIT REJECTION</text>
                            </>
                        ) : (
                            <>
                                <path d="M 20 100 L 100 30" stroke="#22c55e" strokeWidth="1.5" strokeDasharray="4 2" opacity="0.5" />
                                <path d="M 100 30 Q 140 0 180 60 L 260 100" fill="none" stroke={color} strokeWidth="3" markerEnd="url(#arrow)" />
                                <circle cx="100" cy="30" r="4" fill={color} />
                                <text x="100" y="15" fill={color} fontSize="10" textAnchor="middle" fontWeight="bold">WAIT REJECTION</text>
                            </>
                        )}
                    </svg>
                </div>
            );
        };

        // --- 3. CHART COMPONENT ---
        const TradingChart = forwardRef(({ data, analysis, currentPrice, timeframe }, ref) => {
            const containerRef = useRef(null);
            const chartRef = useRef(null);
            const seriesRef = useRef(null);
            const linesRef = useRef({});

            useImperativeHandle(ref, () => ({
                takeScreenshot: () => {
                    return chartRef.current ? chartRef.current.takeScreenshot().toDataURL('image/png') : null;
                },
                zoomToLatest: (bars = 30) => {
                    if (chartRef.current && data.length > 0) {
                        const from = Math.max(0, data.length - bars); 
                        chartRef.current.timeScale().setVisibleLogicalRange({ from, to: data.length + 2 });
                    }
                }
            }));

            // Init
            useEffect(() => {
                if (!containerRef.current || !window.LightweightCharts) return;

                const chart = LightweightCharts.createChart(containerRef.current, {
                    width: containerRef.current.clientWidth,
                    height: 500,
                    layout: { background: { type: 'solid', color: '#000000' }, textColor: '#9ca3af' },
                    grid: { vertLines: { color: '#1f2937' }, horzLines: { color: '#1f2937' } },
                    timeScale: { borderColor: '#374151', timeVisible: true, rightOffset: 12 },
                    rightPriceScale: { borderColor: '#374151' },
                });

                const series = chart.addCandlestickSeries({
                    upColor: '#22c55e', downColor: '#ef4444',
                    borderUpColor: '#22c55e', borderDownColor: '#ef4444',
                    wickUpColor: '#22c55e', wickDownColor: '#ef4444',
                });

                chartRef.current = chart;
                seriesRef.current = series;

                const handleResize = () => chart.applyOptions({ width: containerRef.current.clientWidth });
                window.addEventListener('resize', handleResize);

                return () => {
                    window.removeEventListener('resize', handleResize);
                    chart.remove();
                };
            }, []);

            // Data Update & AUTO ZOOM
            useEffect(() => {
                if (seriesRef.current && data && data.length > 0) {
                    seriesRef.current.setData(data);
                    
                    // Force Zoom on data load/change
                    const barsToShow = 30;
                    const from = Math.max(0, data.length - barsToShow);
                    const to = data.length + 2; 
                    chartRef.current.timeScale().setVisibleLogicalRange({ from, to });
                }
            }, [data]);

            // Line Update
            useEffect(() => {
                if (!seriesRef.current || !analysis) return;

                const series = seriesRef.current;
                const refs = linesRef.current;

                ['current', 'zone', 'sl'].forEach(k => {
                    if (refs[k]) { series.removePriceLine(refs[k]); refs[k] = null; }
                });

                const isBullish = analysis.bias === 'BULLISH';

                refs.current = series.createPriceLine({
                    price: currentPrice,
                    color: '#fbbf24', 
                    lineWidth: 1,
                    lineStyle: LightweightCharts.LineStyle.Dotted,
                    axisLabelVisible: true,
                    title: 'CURRENT',
                });

                refs.zone = series.createPriceLine({
                    price: analysis.zone,
                    color: isBullish ? '#22c55e' : '#ef4444',
                    lineWidth: 3,
                    lineStyle: LightweightCharts.LineStyle.Solid,
                    axisLabelVisible: true,
                    title: isBullish ? 'WAIT BUY' : 'WAIT SELL',
                });

                refs.sl = series.createPriceLine({
                    price: analysis.sl,
                    color: '#ef4444',
                    lineWidth: 2,
                    lineStyle: LightweightCharts.LineStyle.Dashed,
                    axisLabelVisible: true,
                    title: 'SL',
                });

            }, [analysis, currentPrice]);

            return <div ref={containerRef} className="w-full h-full" />;
        });

        // --- 4. MAIN APP ---
        const GoldCommanderApp = () => {
            const [mode, setMode] = useState('LIVE');
            const [backtestDate, setBacktestDate] = useState(new Date().toISOString().split('T')[0]);
            
            const assets = [
                { id: 'GOLD', name: 'Gold (XAU)', apiSymbol: 'PAXGUSDT' },
                { id: 'BTC', name: 'Bitcoin', apiSymbol: 'BTCUSDT' },
                { id: 'ETH', name: 'Ethereum', apiSymbol: 'ETHUSDT' }
            ];
            const [currentAsset, setCurrentAsset] = useState(assets[0]);
            
            const timeframes = [
                { label: 'D1', val: '1d', limit: 365 }, { label: 'H4', val: '4h', limit: 100 },
                { label: 'H1', val: '1h', limit: 100 }, { label: '30m', val: '30m', limit: 100 }, { label: '5m', val: '5m', limit: 100 }
            ];
            const [currentTimeframe, setCurrentTimeframe] = useState(timeframes[0]);

            const [chartData, setChartData] = useState([]);
            const [currentPrice, setCurrentPrice] = useState(0);
            const [analysis, setAnalysis] = useState(null);
            const [inputData, setInputData] = useState({ high: '', low: '', close: '', open: '' });
            const [isEditing, setIsEditing] = useState(false);
            
            const [showMenu, setShowMenu] = useState(false);
            const [showShare, setShowShare] = useState(false);
            const [capturedImg, setCapturedImg] = useState(null);
            
            const chartRef = useRef();

            // Fetch
            const fetchData = async () => {
                try {
                    let endTime = '';
                    if (mode === 'BACKTEST') {
                        const date = new Date(backtestDate);
                        date.setHours(23, 59, 59);
                        endTime = `&endTime=${date.getTime()}`;
                    }
                    
                    const url = `https://api.binance.com/api/v3/klines?symbol=${currentAsset.apiSymbol}&interval=${currentTimeframe.val}&limit=${currentTimeframe.limit}${endTime}`;
                    const res = await fetch(url);
                    const raw = await res.json();
                    
                    if (!Array.isArray(raw)) return;

                    const formatted = raw.map(d => ({
                        time: d[0] / 1000,
                        open: parseFloat(d[1]),
                        high: parseFloat(d[2]),
                        low: parseFloat(d[3]),
                        close: parseFloat(d[4]),
                    }));
                    
                    setChartData(formatted);
                    const lastCandle = raw[raw.length - 1];
                    const price = parseFloat(lastCandle[4]);
                    setCurrentPrice(price);

                    // Analysis
                    const d1Url = `https://api.binance.com/api/v3/klines?symbol=${currentAsset.apiSymbol}&interval=1d&limit=2${endTime}`;
                    const d1Res = await fetch(d1Url);
                    const d1Raw = await d1Res.json();
                    
                    if (Array.isArray(d1Raw) && d1Raw.length >= 2) {
                        const yesterday = d1Raw[d1Raw.length - 2];
                        const input = {
                            open: parseFloat(yesterday[1]),
                            high: parseFloat(yesterday[2]),
                            low: parseFloat(yesterday[3]),
                            close: parseFloat(yesterday[4]),
                        };
                        if(!isEditing) {
                            setInputData(input);
                            runAnalysis(input, price);
                        } else {
                            runAnalysis(inputData, price);
                        }
                    }
                } catch (err) { console.error(err); }
            };

            const runAnalysis = (d1, price) => {
                const isBullish = d1.close > d1.open;
                const bias = isBullish ? 'BULLISH' : 'BEARISH';
                const pp = (d1.high + d1.low + d1.close) / 3;
                const r1 = (2 * pp) - d1.low;
                const s1 = (2 * pp) - d1.high;
                const zone = isBullish ? s1 : r1;
                const slBuffer = currentAsset.id === 'GOLD' ? 5 : (price * 0.015);
                const sl = isBullish ? zone - slBuffer : zone + slBuffer;

                const dateStr = new Date(mode === 'BACKTEST' ? backtestDate : new Date()).toLocaleDateString('th-TH', {
                    day: 'numeric', month: 'long', year: 'numeric'
                });

                let detailedText = "";
                if (isBullish) {
                    detailedText = `ðŸ† à¹à¸œà¸™à¹€à¸—à¸£à¸” ${currentAsset.name} à¸§à¸±à¸™à¸—à¸µà¹ˆ ${dateStr}\n\n` +
                        `1. à¸—à¸´à¸¨à¸—à¸²à¸‡ D1: à¹à¸—à¹ˆà¸‡à¹€à¸¡à¸·à¹ˆà¸­à¸§à¸²à¸™à¸›à¸´à¸”à¹€à¸‚à¸µà¸¢à¸§ à¸ªà¹ˆà¸‡à¸œà¸¥à¹ƒà¸«à¹‰à¸§à¸±à¸™à¸™à¸µà¹‰à¸¡à¸­à¸‡à¸«à¸™à¹‰à¸² "BUY (à¸¢à¹ˆà¸­à¸‹à¸·à¹‰à¸­)" à¹€à¸›à¹‡à¸™à¸«à¸¥à¸±à¸\n\n` +
                        `2. à¹‚à¸‹à¸™à¸£à¸­à¹€à¸‚à¹‰à¸²: à¸£à¸­à¸£à¸²à¸„à¸²à¸¢à¹ˆà¸­à¸•à¸±à¸§à¸¥à¸‡à¸¡à¸²à¸—à¸”à¸ªà¸­à¸šà¹à¸™à¸§à¸£à¸±à¸šà¸ªà¸³à¸„à¸±à¸ (S1) à¸šà¸£à¸´à¹€à¸§à¸“ ${zone.toFixed(2)}\n\n` +
                        `3. à¸ªà¸±à¸à¸à¸²à¸“à¸¢à¸·à¸™à¸¢à¸±à¸™: à¸«à¹‰à¸²à¸¡à¹€à¸‚à¹‰à¸²à¸—à¸±à¸™à¸—à¸µ! à¹ƒà¸«à¹‰à¸£à¸­à¹à¸—à¹ˆà¸‡ H1 à¸ˆà¸šà¹à¸—à¹ˆà¸‡ à¸–à¹‰à¸²à¸¡à¸µà¸à¸²à¸£à¸—à¸´à¹‰à¸‡à¹„à¸ªà¹‰à¸¥à¹ˆà¸²à¸‡à¸¢à¸²à¸§ (Rejection) à¹à¸¥à¸°à¹€à¸™à¸·à¹‰à¸­à¹€à¸—à¸µà¸¢à¸™à¸›à¸´à¸”à¸¢à¸·à¸™à¹€à¸«à¸™à¸·à¸­ ${zone.toFixed(2)} à¹„à¸”à¹‰ à¹ƒà¸«à¹‰à¸«à¸²à¸ˆà¸±à¸‡à¸«à¸§à¸°à¹€à¸‚à¹‰à¸² Buy\n\n` +
                        `4. à¸ˆà¸¸à¸”à¸¢à¸­à¸¡à¹à¸žà¹‰ (SL): à¸•à¸±à¹‰à¸‡à¸—à¸µà¹ˆ ${sl.toFixed(2)} (à¸«à¹‰à¸²à¸¡à¹€à¸¥à¸·à¹ˆà¸­à¸™à¸«à¸™à¸µà¹€à¸”à¹‡à¸”à¸‚à¸²à¸”)`;
                } else {
                    detailedText = `ðŸ† à¹à¸œà¸™à¹€à¸—à¸£à¸” ${currentAsset.name} à¸§à¸±à¸™à¸—à¸µà¹ˆ ${dateStr}\n\n` +
                        `1. à¸—à¸´à¸¨à¸—à¸²à¸‡ D1: à¹à¸—à¹ˆà¸‡à¹€à¸¡à¸·à¹ˆà¸­à¸§à¸²à¸™à¸›à¸´à¸”à¹à¸”à¸‡ à¸ªà¹ˆà¸‡à¸œà¸¥à¹ƒà¸«à¹‰à¸§à¸±à¸™à¸™à¸µà¹‰à¸¡à¸­à¸‡à¸«à¸™à¹‰à¸² "SELL (à¹€à¸”à¹‰à¸‡à¸‚à¸²à¸¢)" à¹€à¸›à¹‡à¸™à¸«à¸¥à¸±à¸\n\n` +
                        `2. à¹‚à¸‹à¸™à¸£à¸­à¹€à¸‚à¹‰à¸²: à¸£à¸­à¸£à¸²à¸„à¸²à¸”à¸µà¸”à¸•à¸±à¸§à¸‚à¸¶à¹‰à¸™à¹„à¸›à¸—à¸”à¸ªà¸­à¸šà¹à¸™à¸§à¸•à¹‰à¸²à¸™à¸ªà¸³à¸„à¸±à¸ (R1) à¸šà¸£à¸´à¹€à¸§à¸“ ${zone.toFixed(2)}\n\n` +
                        `3. à¸ªà¸±à¸à¸à¸²à¸“à¸¢à¸·à¸™à¸¢à¸±à¸™: à¸«à¹‰à¸²à¸¡à¹€à¸‚à¹‰à¸²à¸—à¸±à¸™à¸—à¸µ! à¹ƒà¸«à¹‰à¸£à¸­à¹à¸—à¹ˆà¸‡ H1 à¸ˆà¸šà¹à¸—à¹ˆà¸‡ à¸–à¹‰à¸²à¸¡à¸µà¸à¸²à¸£à¸—à¸´à¹‰à¸‡à¹„à¸ªà¹‰à¸šà¸™à¸¢à¸²à¸§ (Rejection) à¹à¸¥à¸°à¹€à¸™à¸·à¹‰à¸­à¹€à¸—à¸µà¸¢à¸™à¸›à¸´à¸”à¸•à¹ˆà¸³à¸à¸§à¹ˆà¸² ${zone.toFixed(2)} à¹„à¸”à¹‰ à¹ƒà¸«à¹‰à¸«à¸²à¸ˆà¸±à¸‡à¸«à¸§à¸°à¹€à¸‚à¹‰à¸² Sell\n\n` +
                        `4. à¸ˆà¸¸à¸”à¸¢à¸­à¸¡à¹à¸žà¹‰ (SL): à¸•à¸±à¹‰à¸‡à¸—à¸µà¹ˆ ${sl.toFixed(2)} (à¸«à¹‰à¸²à¸¡à¹€à¸¥à¸·à¹ˆà¸­à¸™à¸«à¸™à¸µà¹€à¸”à¹‡à¸”à¸‚à¸²à¸”)`;
                }

                setAnalysis({
                    bias, zone, sl, pp,
                    mode: isBullish ? 'BUY BIAS' : 'SELL BIAS',
                    accent: isBullish ? 'text-green-400' : 'text-red-400',
                    bg: isBullish ? 'bg-green-900/20' : 'bg-red-900/20',
                    cardBg: isBullish ? 'from-green-950 to-black' : 'from-red-950 to-black',
                    fullText: detailedText,
                    steps: [
                        `1. D1 Trend: ${bias}`,
                        `2. Zone: ${zone.toFixed(2)} (${isBullish ? 'S1' : 'R1'})`,
                        `3. Trigger: H1 Rejection`,
                        `4. SL: ${sl.toFixed(2)}`
                    ],
                    dateStr: dateStr
                });
            };

            const handleShare = () => {
                if(chartRef.current && analysis) {
                    chartRef.current.zoomToLatest(20);
                    setTimeout(() => {
                        const img = chartRef.current.takeScreenshot();
                        setCapturedImg(img);
                        setShowShare(true);
                    }, 300);
                }
            };
            
            const handleResetZoom = () => {
                if(chartRef.current) {
                    chartRef.current.zoomToLatest(30);
                }
            };

            const handleInputChange = (e) => setInputData({...inputData, [e.target.name]: parseFloat(e.target.value)});

            useEffect(() => {
                fetchData();
                if (mode === 'LIVE') { const t = setInterval(fetchData, 5000); return () => clearInterval(t); }
            }, [currentAsset, currentTimeframe, mode, backtestDate, isEditing]);

            return (
                <div className="flex flex-col h-screen overflow-hidden">
                    {/* Header */}
                    <header className="bg-black/90 border-b border-gray-800 p-3 flex flex-wrap gap-3 items-center justify-between z-20">
                        <div className="flex items-center gap-4">
                            <div className="bg-yellow-600 text-black font-bold px-2 py-1 rounded shadow-lg">MTA</div>
                            <button onClick={() => setShowMenu(!showMenu)} className="flex items-center gap-2 font-bold text-lg text-white hover:text-yellow-400">
                                {currentAsset.name} <Icons.ChevronDown size={16}/>
                            </button>
                            {showMenu && (
                                <div className="absolute top-12 left-14 bg-gray-900 border border-gray-700 rounded-xl shadow-xl z-50">
                                    {assets.map(a => <button key={a.id} onClick={()=>{setCurrentAsset(a); setShowMenu(false)}} className="block w-full text-left px-4 py-3 hover:bg-gray-800 text-sm text-gray-300">{a.name}</button>)}
                                </div>
                            )}
                        </div>
                        <div className="flex gap-2 items-center overflow-x-auto">
                            <div className="flex bg-gray-900 rounded p-1 border border-gray-700">
                                {timeframes.map(tf => <button key={tf.label} onClick={() => setCurrentTimeframe(tf)} className={`px-3 py-1 rounded text-xs font-bold ${currentTimeframe.val === tf.val ? 'bg-gray-700 text-white' : 'text-gray-500'}`}>{tf.label}</button>)}
                            </div>
                            <div className="flex bg-gray-900 rounded p-1 border border-gray-700">
                                <button onClick={() => setMode('LIVE')} className={`px-3 py-1 flex items-center gap-1 rounded text-xs font-bold ${mode==='LIVE'?'bg-red-600 text-white':'text-gray-500'}`}><Icons.Zap size={12}/> LIVE</button>
                                <button onClick={() => setMode('BACKTEST')} className={`px-3 py-1 flex items-center gap-1 rounded text-xs font-bold ${mode==='BACKTEST'?'bg-blue-600 text-white':'text-gray-500'}`}><Icons.History size={12}/> TEST</button>
                            </div>
                            {mode === 'BACKTEST' && <input type="date" value={backtestDate} onChange={e=>setBacktestDate(e.target.value)} className="bg-gray-900 border border-gray-700 rounded px-2 py-1 text-xs text-white"/>}
                            <div className="flex gap-2">
                                <button onClick={() => setIsEditing(!isEditing)} className={`p-2 rounded border border-gray-600 ${isEditing?'text-yellow-500 border-yellow-500':'text-gray-400 bg-gray-800'}`}><Icons.Edit size={16}/></button>
                                <button onClick={handleShare} className="bg-yellow-600 hover:bg-yellow-500 text-black px-3 py-1.5 rounded font-bold flex items-center gap-2 text-sm"><Icons.Camera size={16}/> Share</button>
                            </div>
                        </div>
                    </header>

                    {/* Content */}
                    <div className="flex-1 flex flex-col md:flex-row overflow-hidden relative">
                        {/* Chart */}
                        <div className="flex-1 relative bg-black">
                            <div className="absolute top-4 right-16 z-10 bg-gray-900/80 backdrop-blur px-3 py-1.5 rounded border border-gray-700 text-right pointer-events-none">
                                <div className="text-[10px] text-gray-400">CURRENT</div>
                                <div className="text-xl font-mono font-bold text-yellow-400">{currentPrice.toFixed(2)}</div>
                            </div>
                            
                            {/* RESET ZOOM BUTTON */}
                            <button 
                                onClick={handleResetZoom}
                                className="absolute bottom-16 right-16 z-20 bg-gray-800/80 hover:bg-gray-700 text-white p-2 rounded-full border border-gray-600 transition-all shadow-lg flex items-center justify-center group"
                                title="Focus View"
                            >
                                <Icons.Focus size={20} />
                            </button>

                            <TradingChart ref={chartRef} data={chartData} analysis={analysis} currentPrice={currentPrice} timeframe={currentTimeframe} />
                        </div>

                        {/* Sidebar Info */}
                        <div className="w-full md:w-80 bg-gray-900 border-l border-gray-800 p-4 flex flex-col gap-4 overflow-y-auto z-10">
                            {/* Editor */}
                            {isEditing && (
                                <div className="p-3 border border-yellow-600 rounded bg-yellow-900/10 mb-2">
                                    <div className="text-xs text-yellow-500 font-bold mb-2">MANUAL EDIT (D1)</div>
                                    <div className="grid grid-cols-2 gap-2">
                                        {['open','high','low','close'].map(f => (
                                            <div key={f}><label className="text-[9px] text-gray-400 uppercase">{f}</label><input name={f} type="number" value={inputData[f]} onChange={handleInputChange} className="w-full bg-black border border-gray-700 rounded px-2 py-1 text-xs text-white"/></div>
                                        ))}
                                    </div>
                                    <button onClick={()=>{runAnalysis(inputData, currentPrice); setIsEditing(false)}} className="w-full mt-2 bg-green-600 text-white text-xs py-1 rounded">Save & Calculate</button>
                                </div>
                            )}

                            {analysis ? (
                                <>
                                    <div className={`p-4 rounded-xl border border-gray-700 ${analysis.bg}`}>
                                        <div className="flex justify-between items-center mb-2">
                                            <span className="text-xs text-gray-400 font-bold tracking-wider">DIRECTION</span>
                                            <span className={`text-xs font-bold px-2 py-0.5 rounded bg-black/30 ${analysis.accent}`}>{analysis.mode}</span>
                                        </div>
                                        <div className="text-3xl font-mono font-bold text-white mb-1">{analysis.zone.toFixed(2)}</div>
                                        <div className="text-[10px] text-gray-400">WAIT FOR REJECTION</div>
                                    </div>
                                    <div className="space-y-3">
                                        <div className="flex justify-between p-3 bg-black rounded border border-gray-800">
                                            <span className="text-xs text-gray-500">STOP LOSS</span>
                                            <span className="text-sm font-mono font-bold text-red-400">{analysis.sl.toFixed(2)}</span>
                                        </div>
                                        <div className="bg-black p-3 rounded border border-gray-800">
                                            <div className="text-[10px] text-gray-500 mb-2 uppercase font-bold flex items-center gap-2"><Icons.FileText size={12}/> Analysis</div>
                                            <div className="text-xs text-gray-300 space-y-1 whitespace-pre-line leading-relaxed">
                                                {analysis.fullText}
                                            </div>
                                        </div>
                                    </div>
                                    <button onClick={() => {navigator.clipboard.writeText(analysis.fullText); alert('Copied Analysis!')}} className="w-full py-2 bg-gray-800 hover:bg-gray-700 rounded text-xs text-gray-300 flex items-center justify-center gap-2 transition-all">
                                        <Icons.Copy size={14}/> Copy Plan Text
                                    </button>
                                </>
                            ) : <div className="text-center text-gray-500 mt-10">Loading...</div>}
                        </div>
                    </div>

                    {/* SHARE MODAL */}
                    {showShare && analysis && (
                        <div className="fixed inset-0 z-50 bg-black/95 backdrop-blur-sm flex items-center justify-center p-4">
                            <div className="w-full max-w-lg relative bg-gray-900 border border-gray-700 rounded-2xl shadow-2xl flex flex-col max-h-[90vh]">
                                <button onClick={() => setShowShare(false)} className="absolute -top-12 right-0 bg-red-600 hover:bg-red-700 text-white p-2 rounded-full shadow-lg transition-all"><Icons.X size={24}/></button>
                                <div className="p-0 overflow-y-auto">
                                    <div className={`h-2 w-full ${analysis.bias === 'BULLISH' ? 'bg-green-500' : 'bg-red-500'}`}></div>
                                    <div className={`p-4 bg-gradient-to-b ${analysis.cardBg}`}>
                                        <div className="flex justify-between items-center mb-4">
                                            <div>
                                                <h2 className="text-3xl font-black text-white tracking-tighter">{currentAsset.name}</h2>
                                                <p className="text-xs text-gray-400">{analysis.dateStr}</p>
                                            </div>
                                            <div className={`px-3 py-1 rounded text-xs font-bold text-black ${analysis.bias === 'BULLISH' ? 'bg-green-500' : 'bg-red-500'}`}>{analysis.mode}</div>
                                        </div>
                                        
                                        {/* Capture */}
                                        <div className="rounded-lg overflow-hidden border border-gray-700 bg-black mb-4 relative">
                                            <div className="absolute top-2 left-2 bg-black/60 backdrop-blur px-2 py-1 rounded text-[9px] text-gray-300 pointer-events-none">Live Zoom (20 Candles)</div>
                                            {capturedImg ? <img src={capturedImg} className="w-full h-auto object-cover" alt="Chart" /> : <div className="h-48 flex items-center justify-center text-gray-600">Generating...</div>}
                                        </div>

                                        {/* Schematic */}
                                        <div className="grid grid-cols-12 gap-3 bg-black/40 rounded-lg p-3 border border-gray-700">
                                            <div className="col-span-7 flex flex-col justify-center">
                                                <div className="text-[10px] text-gray-500 mb-1 uppercase">MTA Setup</div>
                                                <div className="h-20 w-full">
                                                    <MTAChartSimulator bias={analysis.bias} zonePrice={analysis.zone} height={80} />
                                                </div>
                                            </div>
                                            <div className="col-span-5 flex flex-col justify-center gap-2 border-l border-gray-700 pl-3">
                                                <div><div className="text-[9px] text-gray-500 uppercase">ZONE</div><div className="text-lg font-mono font-bold text-white">{analysis.zone.toFixed(2)}</div></div>
                                                <div><div className="text-[9px] text-gray-500 uppercase">SL</div><div className="text-lg font-mono font-bold text-red-500">{analysis.sl.toFixed(2)}</div></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div className="p-4 bg-gray-900 border-t border-gray-800">
                                    <button onClick={() => setShowShare(false)} className="w-full bg-gray-800 hover:bg-gray-700 text-white font-bold py-3 rounded-lg transition-all">à¸›à¸´à¸”à¸«à¸™à¹‰à¸²à¸•à¹ˆà¸²à¸‡</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<GoldCommanderApp />);
    </script>
</body>
</html>
