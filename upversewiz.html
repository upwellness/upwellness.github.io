<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MTA Gold Commander V.9.3 (Embedded Icons)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Sarabun:wght@300;400;600;800&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #444; }
    </style>
</head>
<body class="bg-[#050505] text-gray-200">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // --- EMBEDDED ICONS (No external dependency required) ---
        const IconBase = ({ children, size = 24, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                {children}
            </svg>
        );

        const Icons = {
            TrendingUp: (props) => <IconBase {...props}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18" /><polyline points="17 6 23 6 23 12" /></IconBase>,
            TrendingDown: (props) => <IconBase {...props}><polyline points="23 18 13.5 8.5 8.5 13.5 1 6" /><polyline points="17 18 23 18 23 12" /></IconBase>,
            Target: (props) => <IconBase {...props}><circle cx="12" cy="12" r="10" /><circle cx="12" cy="12" r="6" /><circle cx="12" cy="12" r="2" /></IconBase>,
            Shield: (props) => <IconBase {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" /></IconBase>,
            Activity: (props) => <IconBase {...props}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12" /></IconBase>,
            RefreshCw: (props) => <IconBase {...props}><path d="M21 2v6h-6" /><path d="M3 12a9 9 0 0 1 15-6.7L21 8" /><path d="M3 22v-6h6" /><path d="M21 12a9 9 0 0 1-15 6.7L3 16" /></IconBase>,
            Edit2: (props) => <IconBase {...props}><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" /></IconBase>,
            Check: (props) => <IconBase {...props}><polyline points="20 6 9 17 4 12" /></IconBase>,
            X: (props) => <IconBase {...props}><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></IconBase>,
            Calculator: (props) => <IconBase {...props}><rect x="4" y="2" width="16" height="20" rx="2" /><line x1="8" y1="6" x2="16" y2="6" /><line x1="16" y1="14" x2="16" y2="18" /><path d="M16 10h.01" /><path d="M12 10h.01" /><path d="M8 10h.01" /><path d="M12 14h.01" /><path d="M8 14h.01" /><path d="M12 18h.01" /><path d="M8 18h.01" /></IconBase>,
            Info: (props) => <IconBase {...props}><circle cx="12" cy="12" r="10" /><line x1="12" y1="16" x2="12" y2="12" /><line x1="12" y1="8" x2="12.01" y2="8" /></IconBase>,
            Camera: (props) => <IconBase {...props}><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z" /><circle cx="12" cy="13" r="4" /></IconBase>,
            Share2: (props) => <IconBase {...props}><circle cx="18" cy="5" r="3" /><circle cx="6" cy="12" r="3" /><circle cx="18" cy="19" r="3" /><line x1="8.59" y1="13.51" x2="15.42" y2="17.49" /><line x1="15.41" y1="6.51" x2="8.59" y2="10.49" /></IconBase>,
            Download: (props) => <IconBase {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" y1="15" x2="12" y2="3" /></IconBase>,
            Zap: (props) => <IconBase {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" /></IconBase>,
            Table: (props) => <IconBase {...props}><path d="M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18" /></IconBase>,
            FileText: (props) => <IconBase {...props}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" /><polyline points="14 2 14 8 20 8" /><line x1="16" y1="13" x2="8" y2="13" /><line x1="16" y1="17" x2="8" y2="17" /><polyline points="10 9 9 9 8 9" /></IconBase>,
            Copy: (props) => <IconBase {...props}><rect x="9" y="9" width="13" height="13" rx="2" ry="2" /><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" /></IconBase>,
            Calendar: (props) => <IconBase {...props}><rect x="3" y="4" width="18" height="18" rx="2" ry="2" /><line x1="16" y1="2" x2="16" y2="6" /><line x1="8" y1="2" x2="8" y2="6" /><line x1="3" y1="10" x2="21" y2="10" /></IconBase>,
            History: (props) => <IconBase {...props}><path d="M3 3v5h5" /><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8" /><path d="M12 7v5l4 2" /></IconBase>,
            ChevronDown: (props) => <IconBase {...props}><polyline points="6 9 12 15 18 9" /></IconBase>
        };

        const { TrendingUp, TrendingDown, Target, Shield, Activity, RefreshCw, Edit2, Check, X, Calculator, Info, Camera, Share2, Download, Zap, Table, FileText, Copy, Calendar, History, ChevronDown } = Icons;

        const GoldCommanderV9 = () => {
            const [loading, setLoading] = useState(false);
            const [isEditing, setIsEditing] = useState(false);
            const [showShareCard, setShowShareCard] = useState(false);
            const cardRef = useRef(null);

            // --- ASSETS & MODE CONFIG ---
            const assets = [
                { id: 'PAXGUSDT', name: 'Gold (XAU)', chartSymbol: 'OANDA:XAUUSD', type: 'Commodity' },
                { id: 'BTCUSDT', name: 'Bitcoin (BTC)', chartSymbol: 'BINANCE:BTCUSDT', type: 'Crypto' },
                { id: 'ETHUSDT', name: 'Ethereum (ETH)', chartSymbol: 'BINANCE:ETHUSDT', type: 'Crypto' }
            ];
            const [currentAsset, setCurrentAsset] = useState(assets[0]);
            const [mode, setMode] = useState('LIVE'); // 'LIVE' or 'BACKTEST'
            const [backtestDate, setBacktestDate] = useState(new Date().toISOString().split('T')[0]);
            const [showAssetMenu, setShowAssetMenu] = useState(false);

            // Data States
            const [inputData, setInputData] = useState({ high: '', low: '', close: '', open: '' });
            const [currentPrice, setCurrentPrice] = useState(0);
            const [dayRange, setDayRange] = useState({ high: 0, low: 0 }); 
            const [lastUpdate, setLastUpdate] = useState('');
            
            // Analysis State
            const [analysis, setAnalysis] = useState(null);

            // --- FETCH DATA FUNCTION ---
            const fetchData = async () => {
                if (!analysis) setLoading(true);
                
                try {
                    let url = `https://api.binance.com/api/v3/klines?symbol=${currentAsset.id}&interval=1d&limit=2`;
                    
                    if (mode === 'BACKTEST') {
                        const targetDate = new Date(backtestDate);
                        targetDate.setHours(23, 59, 59, 999); 
                        const endTime = targetDate.getTime();
                        url = `https://api.binance.com/api/v3/klines?symbol=${currentAsset.id}&interval=1d&endTime=${endTime}&limit=2`;
                    }

                    const response = await fetch(url);
                    const data = await response.json();
                    
                    if (!data || data.length < 2) {
                        console.error("Insufficient data for this date");
                        return;
                    }

                    const yesterday = data[0]; 
                    const today = data[1];     

                    const analysisInput = {
                        open: parseFloat(yesterday[1]),
                        high: parseFloat(yesterday[2]),
                        low: parseFloat(yesterday[3]),
                        close: parseFloat(yesterday[4]),
                    };

                    const liveOrClosePrice = parseFloat(today[4]); 
                    const todayHigh = parseFloat(today[2]);
                    const todayLow = parseFloat(today[3]);

                    setCurrentPrice(liveOrClosePrice);
                    setDayRange({ high: todayHigh, low: todayLow });
                    setLastUpdate(new Date().toLocaleTimeString('th-TH'));

                    if (!isEditing) {
                        setInputData(analysisInput);
                        analyzeMarket(analysisInput, liveOrClosePrice);
                    } else {
                        analyzeMarket(inputData, liveOrClosePrice);
                    }

                } catch (error) {
                    console.error("Error fetching data", error);
                } finally {
                    setLoading(false);
                }
            };

            // --- MTA LOGIC ---
            const analyzeMarket = (data, price = currentPrice) => {
                const H = parseFloat(data.high);
                const L = parseFloat(data.low);
                const C = parseFloat(data.close);
                const O = parseFloat(data.open);

                if (isNaN(H) || isNaN(L) || isNaN(C) || isNaN(O)) return;

                const bias = C > O ? 'BULLISH' : 'BEARISH';
                
                const pp = (H + L + C) / 3;
                const r1 = (2 * pp) - L;
                const s1 = (2 * pp) - H;

                const targetZone = bias === 'BULLISH' ? s1 : r1;
                const distance = Math.abs(price - targetZone);

                const assetName = currentAsset.name.split(' ')[0];
                const step1 = bias === 'BULLISH'
                    ? `ทิศทาง D1 จบเขียว (Bullish) → วันนี้ ${assetName} โฟกัสหน้า BUY (ย่อซื้อ)`
                    : `ทิศทาง D1 จบแดง (Bearish) → วันนี้ ${assetName} โฟกัสหน้า SELL (เด้งขาย)`;

                const step2 = bias === 'BULLISH'
                    ? `รอราคา ${assetName} ย่อตัวลงมาทดสอบ S1 ที่ ${s1.toFixed(2)}`
                    : `รอราคา ${assetName} ดีดตัวขึ้นไปทดสอบ R1 ที่ ${r1.toFixed(2)}`;

                const step3 = bias === 'BULLISH'
                    ? "สัญญาณเข้า: รอแท่ง H1 จบแท่ง ต้องเห็นการทิ้งไส้ล่าง (Rejection) และเนื้อปิดยืนเหนือโซน"
                    : "สัญญาณเข้า: รอแท่ง H1 จบแท่ง ต้องเห็นการทิ้งไส้บน (Rejection) และเนื้อปิดต่ำกว่าโซน";

                const slBuffer = currentAsset.type === 'Crypto' ? (price * 0.01) : 5; 
                const slPrice = bias === 'BULLISH' ? s1 - slBuffer : r1 + slBuffer;
                
                const step4 = `ความปลอดภัย (MM): SL ที่ ${slPrice.toFixed(2)} (Stop Loss) ห้ามเลื่อนหนี`;

                let plan = {};
                if (bias === 'BULLISH') {
                    plan = {
                        mode: 'BUY BIAS',
                        color: 'text-green-400',
                        cardBg: 'from-green-950 to-black',
                        accent: 'bg-green-500',
                        borderColor: 'border-green-500',
                        zone: s1,
                        zoneName: 'SUPPORT (S1)',
                        action: 'รอราคาย่อแตะ S1 แล้วรอจบแท่ง H1',
                        sl: slPrice,
                        tp: r1,
                        steps: [step1, step2, step3, step4]
                    };
                } else {
                    plan = {
                        mode: 'SELL BIAS',
                        color: 'text-red-400',
                        cardBg: 'from-red-950 to-black',
                        accent: 'bg-red-500',
                        borderColor: 'border-red-500',
                        zone: r1,
                        zoneName: 'RESISTANCE (R1)',
                        action: 'รอราคาเด้งชน R1 แล้วรอจบแท่ง H1',
                        sl: slPrice,
                        tp: s1,
                        steps: [step1, step2, step3, step4]
                    };
                }

                setAnalysis({ bias, pp, r1, s1, H, L, distance, ...plan });
            };

            const handleInputChange = (e) => {
                setInputData({ ...inputData, [e.target.name]: e.target.value });
            };

            const saveManualData = () => {
                analyzeMarket(inputData);
                setIsEditing(false);
            };
            
            const copyAnalysis = () => {
                if(!analysis) return;
                const text = `แผนเทรด ${currentAsset.name} (${new Date().toLocaleDateString('th-TH')})\n\n1. ${analysis.steps[0]}\n2. ${analysis.steps[1]}\n3. ${analysis.steps[2]}\n4. ${analysis.steps[3]}`;
                navigator.clipboard.writeText(text);
                alert('คัดลอกบทวิเคราะห์แล้ว!');
            }

            useEffect(() => {
                fetchData();
                if (mode === 'LIVE') {
                    const intervalId = setInterval(fetchData, 10000); 
                    return () => clearInterval(intervalId);
                }
            }, [currentAsset, mode, backtestDate, isEditing]);

            return (
                <div className="min-h-screen bg-[#050505] text-gray-200 font-sans flex flex-col relative overflow-x-hidden">
                    
                    {/* NAVBAR */}
                    <div className="border-b border-gray-800 bg-black/90 backdrop-blur sticky top-0 z-40 shadow-xl">
                        <div className="max-w-7xl mx-auto px-4 py-3 flex flex-col md:flex-row justify-between items-center gap-4 md:gap-0">
                            
                            {/* LOGO & ASSET SELECTOR */}
                            <div className="flex items-center gap-4 w-full md:w-auto">
                                <div className="p-2 bg-gradient-to-tr from-yellow-600 to-yellow-500 rounded text-black font-bold shadow-[0_0_15px_rgba(202,138,4,0.4)]">
                                    MTA
                                </div>
                                
                                <div className="relative">
                                    <button onClick={() => setShowAssetMenu(!showAssetMenu)} className="flex items-center gap-2 text-white font-bold text-lg hover:text-yellow-400 transition-colors">
                                        {currentAsset.name} <ChevronDown size={16}/>
                                    </button>
                                    {showAssetMenu && (
                                        <div className="absolute top-full left-0 mt-2 w-48 bg-gray-900 border border-gray-700 rounded-xl shadow-2xl z-50 overflow-hidden">
                                            {assets.map(asset => (
                                                <button
                                                    key={asset.id}
                                                    onClick={() => { setCurrentAsset(asset); setShowAssetMenu(false); }}
                                                    className={`w-full text-left px-4 py-3 hover:bg-gray-800 flex items-center justify-between ${currentAsset.id === asset.id ? 'text-yellow-500 bg-gray-800' : 'text-gray-300'}`}
                                                >
                                                    {asset.name}
                                                    {currentAsset.id === asset.id && <Check size={14}/>}
                                                </button>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                            
                            {/* TOOLS */}
                            <div className="flex items-center gap-3 w-full md:w-auto overflow-x-auto">
                                <div className="bg-gray-900 p-1 rounded-lg border border-gray-700 flex items-center shrink-0">
                                    <button onClick={() => setMode('LIVE')} className={`px-3 py-1.5 rounded text-xs font-bold flex items-center gap-1 transition-all ${mode === 'LIVE' ? 'bg-red-600 text-white shadow-lg' : 'text-gray-500 hover:text-gray-300'}`}>
                                        <Zap size={12} fill={mode === 'LIVE' ? "currentColor" : "none"}/> LIVE
                                    </button>
                                    <button onClick={() => setMode('BACKTEST')} className={`px-3 py-1.5 rounded text-xs font-bold flex items-center gap-1 transition-all ${mode === 'BACKTEST' ? 'bg-blue-600 text-white shadow-lg' : 'text-gray-500 hover:text-gray-300'}`}>
                                        <History size={12}/> BACKTEST
                                    </button>
                                </div>

                                {mode === 'BACKTEST' && (
                                    <div className="relative shrink-0">
                                        <input type="date" value={backtestDate} onChange={(e) => setBacktestDate(e.target.value)} className="bg-gray-900 border border-gray-700 text-white text-xs rounded-lg px-3 py-2 outline-none focus:border-blue-500" />
                                    </div>
                                )}

                                {!isEditing ? (
                                    <div className="flex gap-2 shrink-0">
                                        <button onClick={() => setIsEditing(true)} className="p-2 bg-gray-800 hover:bg-gray-700 rounded border border-gray-600 text-gray-400 transition-all"><Edit2 size={16} /></button>
                                        <button onClick={() => setShowShareCard(true)} className="p-2 bg-yellow-600 hover:bg-yellow-500 text-black rounded shadow-lg transition-all"><Share2 size={16} /></button>
                                    </div>
                                ) : (
                                    <div className="flex gap-2 shrink-0">
                                        <button onClick={() => setIsEditing(false)} className="p-2 text-red-400 rounded border border-red-900 hover:bg-red-900/20"><X size={16}/></button>
                                        <button onClick={saveManualData} className="p-2 bg-green-600 text-white rounded hover:bg-green-500"><Check size={16}/></button>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* SHARE CARD OVERLAY */}
                    {showShareCard && analysis && (
                        <div className="fixed inset-0 z-50 bg-black/90 backdrop-blur-sm flex items-center justify-center p-4 overflow-y-auto">
                            <div className="w-full max-w-md">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-white font-bold flex items-center gap-2"><Camera size={18}/> Share Preview</h3>
                                    <button onClick={() => setShowShareCard(false)} className="text-gray-400 hover:text-white"><X size={24}/></button>
                                </div>
                                <div ref={cardRef} className="bg-gray-900 rounded-xl overflow-hidden shadow-2xl border border-gray-700 relative">
                                    <div className={`h-2 w-full ${analysis.accent}`}></div>
                                    <div className={`p-6 bg-gradient-to-b ${analysis.cardBg}`}>
                                        <div className="flex justify-between items-start mb-6">
                                            <div>
                                                <h2 className="text-3xl font-black text-white tracking-tighter">{currentAsset.name.split(' ')[0]}</h2>
                                                <p className="text-xs text-gray-400">{new Date(mode === 'BACKTEST' ? backtestDate : new Date()).toLocaleDateString('th-TH', { day: 'numeric', month: 'long', year: 'numeric' })}</p>
                                            </div>
                                            <div className="text-right">
                                                <div className={`inline-block px-3 py-1 rounded text-xs font-bold text-black mb-1 ${analysis.accent}`}>{analysis.mode}</div>
                                            </div>
                                        </div>
                                        
                                        {/* SVG Chart */}
                                        <div className="bg-black/40 rounded-lg p-4 mb-6 border border-gray-700/50 relative h-40 flex items-center justify-center overflow-hidden">
                                            <svg className="w-full h-full" viewBox="0 0 300 150">
                                                <defs>
                                                    <linearGradient id="gradGreen" x1="0%" y1="0%" x2="0%" y2="100%">
                                                        <stop offset="0%" style={{ stopColor: "#22c55e", stopOpacity: 0.3 }} />
                                                        <stop offset="100%" style={{ stopColor: "#22c55e", stopOpacity: 0 }} />
                                                    </linearGradient>
                                                    <linearGradient id="gradRed" x1="0%" y1="0%" x2="0%" y2="100%">
                                                        <stop offset="0%" style={{ stopColor: "#ef4444", stopOpacity: 0.3 }} />
                                                        <stop offset="100%" style={{ stopColor: "#ef4444", stopOpacity: 0 }} />
                                                    </linearGradient>
                                                    <marker id="arrowheadGreen" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
                                                        <path d="M0,0 L0,6 L6,3 z" fill="#22c55e" />
                                                    </marker>
                                                    <marker id="arrowheadRed" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
                                                        <path d="M0,0 L0,6 L6,3 z" fill="#ef4444" />
                                                    </marker>
                                                </defs>

                                                <line x1="0" y1="37" x2="300" y2="37" stroke="#333" strokeWidth="0.5" strokeDasharray="2 2"/>
                                                <line x1="0" y1="75" x2="300" y2="75" stroke="#333" strokeWidth="0.5" strokeDasharray="2 2"/>
                                                <line x1="0" y1="112" x2="300" y2="112" stroke="#333" strokeWidth="0.5" strokeDasharray="2 2"/>

                                                <line x1="20" y1="75" x2="280" y2="75" stroke="#fbbf24" strokeWidth="1" strokeDasharray="2 2" opacity="0.6" />
                                                <text x="285" y="79" fill="#fbbf24" fontSize="10" fontFamily="monospace">P</text>

                                                {analysis.bias === 'BULLISH' ? (
                                                    <>
                                                        <text x="20" y="15" fill="#ef4444" fontSize="9">TP: {analysis.tp.toFixed(2)}</text>
                                                        <line x1="20" y1="130" x2="280" y2="130" stroke="#22c55e" strokeWidth="2" />
                                                        <text x="285" y="134" fill="#22c55e" fontSize="10" fontWeight="bold">S1</text>
                                                        <text x="20" y="145" fill="#22c55e" fontSize="11" fontWeight="bold">{analysis.s1.toFixed(2)}</text>
                                                        <rect x="20" y="110" width="260" height="40" fill="url(#gradGreen)" rx="4" />
                                                        <path d="M0 60 L40 50 L80 90 L120 125 L140 115 L160 130 L180 110" fill="none" stroke="#666" strokeWidth="2" opacity="0.5" />
                                                        <path d="M180 110 L220 60 L280 25" fill="none" stroke="#22c55e" strokeWidth="3" markerEnd="url(#arrowheadGreen)" strokeDasharray="5 5"/>
                                                        <circle cx="120" cy="125" r="3" fill="#22c55e" />
                                                        <text x="140" y="100" fill="#22c55e" fontSize="10" fontWeight="bold">WAIT REJECTION</text>
                                                    </>
                                                ) : (
                                                    <>
                                                        <text x="285" y="24" fill="#ef4444" fontSize="10" fontWeight="bold">R1</text>
                                                        <text x="20" y="15" fill="#ef4444" fontSize="11" fontWeight="bold">{analysis.r1.toFixed(2)}</text>
                                                        <line x1="20" y1="130" x2="280" y2="130" stroke="#22c55e" strokeWidth="1" strokeDasharray="4 2" opacity="0.5" />
                                                        <rect x="20" y="0" width="260" height="40" fill="url(#gradRed)" rx="4" />
                                                        <path d="M0 90 L40 100 L80 60 L120 25 L140 35 L160 15 L180 40" fill="none" stroke="#666" strokeWidth="2" opacity="0.5" />
                                                        <path d="M180 40 L220 90 L280 125" fill="none" stroke="#ef4444" strokeWidth="3" markerEnd="url(#arrowheadRed)" strokeDasharray="5 5"/>
                                                        <circle cx="120" cy="25" r="3" fill="#ef4444" />
                                                        <text x="140" y="60" fill="#ef4444" fontSize="10" fontWeight="bold">WAIT REJECTION</text>
                                                    </>
                                                )}
                                            </svg>
                                        </div>
                                        
                                        <div className="flex justify-between items-end border-b border-gray-700 pb-4 mb-4">
                                            <div>
                                                <div className="text-[10px] text-gray-400 uppercase tracking-widest mb-1">WAIT AT ZONE</div>
                                                <div className={`text-5xl font-mono font-bold tracking-tighter text-white drop-shadow-lg`}>{analysis.zone.toFixed(2)}</div>
                                            </div>
                                        </div>
                                        <div className="bg-black/40 rounded p-3 text-[10px] text-gray-300 space-y-2">
                                            {analysis.steps.map((step, i) => (
                                                <div key={i} className="flex gap-2 items-start">
                                                    <span className={`min-w-[12px] h-[12px] flex items-center justify-center rounded-full ${analysis.accent} text-black font-bold text-[8px] mt-0.5`}>{i+1}</span>
                                                    <span className="leading-tight">{step}</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* MAIN CONTENT */}
                    <div className="flex-1 max-w-7xl mx-auto w-full p-4 grid grid-cols-1 lg:grid-cols-12 gap-6">
                        
                        {/* LEFT PANEL */}
                        <div className="lg:col-span-4 space-y-4">
                            
                            {/* PRICE & INFO CARD */}
                            <div className={`p-4 rounded-xl border flex justify-between items-center relative overflow-hidden shadow-lg transition-colors ${mode === 'LIVE' ? 'bg-gradient-to-r from-gray-900 to-black border-gray-800' : 'bg-gradient-to-r from-blue-900/20 to-black border-blue-900'}`}>
                                <div className="relative z-10">
                                    <p className="text-[10px] text-gray-500 uppercase flex items-center gap-1">
                                        {mode === 'LIVE' ? <Zap size={10} className="text-yellow-500"/> : <History size={10} className="text-blue-500"/>}
                                        {mode === 'LIVE' ? 'LIVE MARKET PRICE' : `CLOSE PRICE (${backtestDate})`}
                                    </p>
                                    <h2 className="text-4xl font-mono font-bold text-white tracking-tighter mt-1">{currentPrice.toFixed(2)}</h2>
                                </div>
                                {mode === 'BACKTEST' && analysis && (
                                    <div className="text-right z-10">
                                        <div className="text-[10px] text-gray-400">Day Range</div>
                                        <div className="text-xs font-mono text-gray-300">H: {dayRange.high.toFixed(2)}</div>
                                        <div className="text-xs font-mono text-gray-300">L: {dayRange.low.toFixed(2)}</div>
                                        <div className={`mt-1 text-[10px] font-bold px-2 py-0.5 rounded ${
                                            (analysis.bias === 'BULLISH' && dayRange.low <= analysis.s1) || (analysis.bias === 'BEARISH' && dayRange.high >= analysis.r1)
                                            ? 'bg-green-900 text-green-400'
                                            : 'bg-gray-800 text-gray-500'
                                        }`}>
                                            {((analysis.bias === 'BULLISH' && dayRange.low <= analysis.s1) || (analysis.bias === 'BEARISH' && dayRange.high >= analysis.r1)) ? 'HIT ZONE ✅' : 'MISSED ZONE'}
                                        </div>
                                    </div>
                                )}
                            </div>
                            
                            {/* ANALYSIS BOX */}
                            {analysis && (
                                <div className={`rounded-xl overflow-hidden border ${analysis.borderColor} bg-gray-900 shadow-xl`}>
                                    <div className="bg-gray-800/50 p-3 border-b border-gray-800 flex justify-between items-center">
                                        <h3 className="text-xs font-bold text-gray-300 flex items-center gap-2"><FileText size={14}/> PLAN: {currentAsset.name}</h3>
                                        <button onClick={copyAnalysis} className="text-[10px] bg-gray-700 hover:bg-gray-600 px-2 py-1 rounded flex items-center gap-1 text-white transition-all">
                                            <Copy size={10}/> Copy
                                        </button>
                                    </div>
                                    <div className="p-4 text-sm text-gray-300 space-y-3 leading-relaxed">
                                        {analysis.steps.map((step, i) => (
                                            <div key={i} className="flex gap-3">
                                                <div className={`min-w-[20px] h-[20px] rounded-full ${analysis.accent} text-black font-bold text-xs flex items-center justify-center shrink-0 mt-0.5`}>{i+1}</div>
                                                <div>{step}</div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                            
                            {/* DATA MONITOR */}
                            <div className={`rounded-xl overflow-hidden border border-gray-800 bg-gray-900`}>
                                <div className="bg-gray-800/50 p-3 border-b border-gray-800 flex justify-between items-center">
                                    <h3 className="text-xs font-bold text-gray-400 uppercase flex items-center gap-2"><Table size={14}/> DATA MONITOR ({mode})</h3>
                                </div>
                                <div className="p-4">
                                    <div className="grid grid-cols-4 gap-2 mb-4">
                                        {['open', 'high', 'low', 'close'].map((field) => (
                                            <div key={field} className="space-y-1">
                                                <label className="text-[9px] text-gray-500 uppercase font-bold block">{field}</label>
                                                <input name={field} type="number" disabled={!isEditing} value={inputData[field]} onChange={handleInputChange} className={`w-full bg-black border rounded p-1.5 text-xs text-center font-mono text-white ${isEditing ? 'border-yellow-500' : 'border-gray-800 text-gray-400'}`}/>
                                            </div>
                                        ))}
                                    </div>
                                    <div className="text-[10px] text-gray-500 text-center">
                                        * Data source: {mode === 'LIVE' ? 'Yesterday Candle' : 'Selected Date Candle'}
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* RIGHT PANEL: CHART */}
                        <div className="lg:col-span-8 bg-black rounded-xl border border-gray-800 overflow-hidden relative min-h-[600px] shadow-2xl flex flex-col">
                        <div className="absolute top-4 left-4 z-10 bg-black/80 backdrop-blur px-3 py-1.5 rounded-lg border border-gray-700 pointer-events-none flex items-center gap-2">
                                <div className={`w-2 h-2 rounded-full animate-pulse ${mode === 'LIVE' ? 'bg-green-500' : 'bg-blue-500'}`}></div>
                                <div>
                                    <span className="text-yellow-500 font-bold text-sm block leading-none">{currentAsset.name} CHART</span>
                                    <span className="text-[10px] text-gray-400 block leading-none mt-1">{mode === 'LIVE' ? 'Live Market' : `Backtest Reference: ${backtestDate}`}</span>
                                </div>
                        </div>
                        
                        <div className="flex-1 w-full h-full relative">
                            <iframe 
                                key={currentAsset.chartSymbol} 
                                title="TradingView Chart" 
                                src={`https://s.tradingview.com/widgetembed/?frameElementId=tradingview_widget&symbol=${currentAsset.chartSymbol}&interval=D&hidesidetoolbar=1&symboledit=1&saveimage=1&toolbarbg=f1f3f6&studies=["PivotPointsStandard@tv-basicstudies"]&theme=dark&style=1&timezone=Asia/Bangkok&withdateranges=1&studies_overrides={}&overrides={}&enabled_features=[]&disabled_features=[]&locale=en&utm_source=tradingview.com&utm_medium=widget&utm_campaign=chart&utm_term=${currentAsset.chartSymbol}`} 
                                style={{ width: '100%', height: '100%', minHeight: '600px', border: 'none' }} 
                                allowFullScreen
                            ></iframe>
                        </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<GoldCommanderV9 />);
    </script>
</body>
</html>
