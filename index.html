<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metabolic Health Check - UP Labs</title>
    
    <!-- 1. React & ReactDOM -->
    <script crossorigin src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- 2. Babel -->
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    
    <!-- 3. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 4. Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- 1. Embedded Icons (100% Reliable) ---
        // ‡∏ù‡∏±‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡∏¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏ß‡∏£‡πå ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏∂‡πà‡∏á CDN
        const ICONS_PATH = {
            // UI Icons
            Activity: '<path d="M22 12h-4l-3 9L9 3l-3 9H2"/>',
            User: '<path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>',
            Ruler: '<path d="M6 18h12"/><path d="M6 6h12"/><path d="M6 12h12"/><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2z"/>',
            Scale: '<path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1z"/><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1z"/><path d="M7 21h10"/><path d="M12 3v18"/><path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2"/>',
            ArrowRight: '<path d="M5 12h14"/><path d="m12 5 7 7-7 7"/>',
            ChevronRight: '<path d="m9 18 6-6-6-6"/>',
            ClipboardList: '<rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/>',
            Utensils: '<path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/>',
            AlertCircle: '<circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/>',
            CheckCircle: '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>',
            Battery: '<rect width="16" height="10" x="2" y="7" rx="2" ry="2"/><line x1="22" x2="22" y1="11" y2="13"/>',
            Phone: '<path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>',
            MessageSquare: '<path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>',
            Info: '<circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/>',
            Lock: '<rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>',
            Unlock: '<rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/>',
            Gift: '<polyline points="20 12 20 22 4 22 4 12"/><rect width="20" height="5" x="2" y="7"/><line x1="12" x2="12" y1="22" y2="7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/>',
            RefreshCw: '<path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/>',
            XCircle: '<circle cx="12" cy="12" r="10"/><line x1="15" x2="9" y1="9" y2="15"/><line x1="9" x2="15" y1="9" y2="15"/>',
            Dumbbell: '<path d="m6.5 6.5 11 11"/><path d="m21 21-1-1"/><path d="m3 3 1 1"/><path d="m18 22 4-4"/><path d="m2 6 4-4"/><path d="m3 10 7-7"/><path d="m14 21 7-7"/>',
            Zap: '<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>',
            
            // Food Icons (Simulated with standard Lucide paths)
            CupSoda: '<path d="m6 8 1.75 12.28a2 2 0 0 0 2 1.72h4.54a2 2 0 0 0 2-1.72L18 8"/><path d="M5 8h14"/><path d="M7 15a6.47 6.47 0 0 1 5 0 6.47 6.47 0 0 0 5 0"/><path d="m12 8 1.5-3h2.5"/><path d="M8 8 9.5 5H12"/>',
            Banana: '<path d="M4 13c1.1 0 2.1-.4 3-1.2 2.6-2.2 5.2-4.4 7.8-6.6a5 5 0 0 1 7 7c-1.7 2.2-4.3 4.7-7.8 6.4-1.2.6-2.3 1-3.4 1.2-1.9.4-3.6-.4-4.6-1.8z"/>',
            Cookie: '<path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5"/><path d="M8.5 8.5v.01"/><path d="M16 15.5v.01"/><path d="M12 12v.01"/><path d="M11 17v.01"/><path d="M7 14v.01"/>',
            CircleDot: '<circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/>',
            Croissant: '<path d="m2.3 14.5 9-9a2.5 2.5 0 0 1 2.9-.4 2.5 2.5 0 0 1 .4 2.9l-9 9a2.5 2.5 0 0 1-2.9.4 2.5 2.5 0 0 1-.4-2.9z"/><path d="M12 7a2 2 0 0 1 0 4"/><path d="M8 11a2 2 0 0 1 0 4"/><path d="M4 15a2 2 0 0 1 0 4"/><path d="M12 7c2 2 3.8 3.5 5.3 4.5"/><path d="M22 22a2 2 0 0 0-2-2c-2.3 0-4.3-1.2-6-3"/>',
            IceCream: '<path d="m7 11 4.08 10.35a1 1 0 0 0 1.84 0L17 11"/><path d="M17 7A5 5 0 0 0 7 7"/><path d="M17 7a2 2 0 0 1 0 4H7a2 2 0 0 1 0-4"/>',
            Coffee: '<path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" x2="6" y1="2" y2="4"/><line x1="10" x2="10" y1="2" y2="4"/><line x1="14" x2="14" y1="2" y2="4"/>',
            Wheat: '<path d="M2 22 16 8"/><path d="M3.47 12.53 5 11l1.53 1.53a3.5 3.5 0 0 1 0 4.94L2 22l4.53-4.53a3.5 3.5 0 0 1 4.94 0L13 19l-1.53 1.53"/><path d="M16 8 8 16"/><path d="M12 2l4 4"/><path d="M16 6l4 4"/><path d="M19 9l3 3"/>',
            Grab: '<path d="M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0"/><path d="M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2"/><path d="M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8"/><path d="M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"/>',
            Nut: '<path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5"/><path d="M12 12v.01"/>',
            Apple: '<path d="M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z"/><path d="M10 2c1 .5 2 2 2 5"/>',
            Grape: '<circle cx="12" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="12" r="3"/><circle cx="12" cy="19" r="3"/>',
            Egg: '<path d="M12 22c4.97 0 9-4.03 9-9 0-4.97-9-13-9-13S3 8.03 3 13c0 4.97 4.03 9 9 9Z"/>',
            Drumstick: '<path d="M17.3 3.6a2.6 2.6 0 1 1 3.5 3.5l-2.1 2.1a2 2 0 0 0 0 2.8l1.4 1.4a2 2 0 0 1 0 2.8l-1.4 1.4a2 2 0 0 1-2.8 0l-1.4-1.4a2 2 0 0 0-2.8 0l-7.1 7.1a2.6 2.6 0 1 1-3.5-3.5L17.3 3.6Z"/>',
            Fish: '<path d="M6.5 12c.94-2.08 2.3-4 4.5-5 2.2-1 4.85-.75 7 .5a9 9 0 0 1 4 4 9 9 0 0 1-4 4c-2.15 1.25-4.8.5-7-.5-2.2-1-3.56-2.92-4.5-5Z"/><path d="M6.5 12A6.5 6.5 0 0 0 2 18"/><path d="M6.5 12A6.5 6.5 0 0 1 2 6"/>',
            Box: '<path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" x2="12" y1="22.08" y2="12"/>',
            Milk: '<path d="M8 2h8"/><path d="M9 2v2.78c0 .84-.34 1.63-.92 2.22l-4.16 4.16c-.58.59-.92 1.38-.92 2.22V19a3 3 0 0 0 3 3h12a3 3 0 0 0 3-3v-5.62c0-.84-.34-1.63-.92-2.22L15.92 7c-.58-.59-.92-1.38-.92-2.22V2"/>',
            FishSymbol: '<path d="M2 16s9-15 20-4C11 23 2 8 2 8"/>',
            Bean: '<path d="M10.165 6.598C9.954 7.478 9.64 8.36 9 9c-.64.64-1.521.954-2.402 1.165A6 6 0 0 0 8 22c7.732 0 14-6.268 14-14a6 6 0 0 0-11.835-1.402Z"/><path d="M5.341 10.62a4 4 0 1 0 5.279-5.28"/>',
            Shell: '<path d="M14 11a2 2 0 1 1-4 0 4 4 0 0 1 8 0 6 6 0 0 1-12 0 8 8 0 0 1 16 0 10 10 0 1 1-20 0 11.93 11.93 0 0 1 2.42-7.22 2 2 0 1 1 3.16 2.44"/>',
            GlassWater: '<path d="M15.2 22H8.8a2 2 0 0 1-2-1.79L5 3h14l-1.81 17.21A2 2 0 0 1 15.2 22Z"/><path d="M6 8h12"/><path d="M6 13h12"/>'
        };

        const Icon = ({ name, size = 24, className = "", color = "currentColor" }) => {
            const svgContent = ICONS_PATH[name] || `<circle cx="12" cy="12" r="10" />`; // Fallback to circle
            return (
                <svg 
                    width={size} 
                    height={size} 
                    viewBox="0 0 24 24" 
                    fill="none" 
                    stroke={color} 
                    strokeWidth="2" 
                    strokeLinecap="round" 
                    strokeLinejoin="round" 
                    className={className}
                    dangerouslySetInnerHTML={{ __html: svgContent }}
                />
            );
        };

        // --- Configuration ---
        const SUPABASE_URL = "https://qzqvwbucjxwgtmbdkrlu.supabase.co"; 
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF6cXZ3YnVjanh3Z3RtYmRrcmx1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzNzgxODksImV4cCI6MjA4MDk1NDE4OX0.RYvc5kMueNhsOu---WOKcXYnOZLVnjiWklp1IiHmgS8";

        // Initialize Supabase
        let dbClient = null;
        try {
            if (window.supabase && typeof window.supabase.createClient === 'function') {
                dbClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            }
        } catch (e) {
            console.error("Supabase Init Failed:", e);
        }

        // --- Database Data ---
        const SNACK_DATABASE = [
            { name: '‡∏ä‡∏≤‡∏ô‡∏°‡πÑ‡∏Ç‡πà‡∏°‡∏∏‡∏Å (1 ‡πÅ‡∏Å‡πâ‡∏ß)', kcal: 350, c: 60, f: 10, p: 1, icon: 'CupSoda' },
            { name: '‡∏Å‡∏•‡πâ‡∏ß‡∏¢‡πÅ‡∏Ç‡∏Å (3 ‡∏ä‡∏¥‡πâ‡∏ô)', kcal: 280, c: 45, f: 12, p: 1, icon: 'Banana' },
            { name: '‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ‡πÄ‡∏ô‡∏¢ (2 ‡∏ä‡∏¥‡πâ‡∏ô)', kcal: 180, c: 20, f: 10, p: 2, icon: 'Cookie' },
            { name: '‡∏•‡∏π‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏ó‡∏≠‡∏î (5 ‡∏•‡∏π‡∏Å)', kcal: 250, c: 30, f: 12, p: 8, icon: 'CircleDot' },
            { name: '‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡πÑ‡∏™‡πâ‡∏Ñ‡∏£‡∏µ‡∏°', kcal: 320, c: 45, f: 14, p: 6, icon: 'Croissant' },
            { name: '‡πÑ‡∏≠‡∏®‡∏Å‡∏£‡∏µ‡∏°‡∏Å‡∏∞‡∏ó‡∏¥', kcal: 220, c: 25, f: 12, p: 2, icon: 'IceCream' }, 
            { name: '‡∏Å‡∏≤‡πÅ‡∏ü‡πÄ‡∏¢‡πá‡∏ô‡∏´‡∏ß‡∏≤‡∏ô‡∏°‡∏±‡∏ô', kcal: 280, c: 35, f: 12, p: 3, icon: 'Coffee' },
            { name: '‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á', kcal: 350, c: 65, f: 8, p: 4, icon: 'Utensils' },
            { name: '‡∏õ‡∏≤‡∏ó‡πà‡∏≠‡∏á‡πÇ‡∏Å‡πã (1 ‡∏Ñ‡∏π‡πà)', kcal: 150, c: 18, f: 8, p: 2, icon: 'Wheat' },
            { name: '‡∏°‡∏±‡∏ô‡∏ù‡∏£‡∏±‡πà‡∏á‡∏ó‡∏≠‡∏î', kcal: 160, c: 15, f: 10, p: 2, icon: 'Grab' },
        ];

        const HEALTHY_SNACK_DATABASE = [
            { name: '‡∏≠‡∏±‡∏•‡∏°‡∏≠‡∏ô‡∏î‡πå (1 ‡∏Å‡∏≥‡∏°‡∏∑‡∏≠)', kcal: 160, c: 6, f: 14, p: 6, icon: 'Nut' },
            { name: '‡∏ù‡∏£‡∏±‡πà‡∏á (1 ‡∏•‡∏π‡∏Å)', kcal: 60, c: 15, f: 0, p: 2, icon: 'Apple' },
            { name: '‡∏î‡∏≤‡∏£‡πå‡∏Å‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï 85%', kcal: 120, c: 8, f: 10, p: 2, icon: 'Cookie' },
            { name: '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà‡∏£‡∏ß‡∏°', kcal: 50, c: 12, f: 0, p: 1, icon: 'Grape' },
            { name: '‡πÑ‡∏Ç‡πà‡∏ï‡πâ‡∏°‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£', kcal: 70, c: 0, f: 5, p: 6, icon: 'Egg' },
        ];

        const PROTEIN_DATABASE = [
            { name: '‡πÑ‡∏Ç‡πà‡∏ï‡πâ‡∏° (2 ‡∏ü‡∏≠‡∏á)', protein: 14, kcal: 140, icon: 'Egg' },
            { name: '‡∏≠‡∏Å‡πÑ‡∏Å‡πà‡∏•‡∏ß‡∏Å (100g)', protein: 23, kcal: 120, icon: 'Drumstick' },
            { name: '‡∏õ‡∏•‡∏≤‡πÅ‡∏ã‡∏•‡∏°‡∏≠‡∏ô (100g)', protein: 20, kcal: 200, icon: 'Fish' },
            { name: '‡πÄ‡∏ï‡πâ‡∏≤‡∏´‡∏π‡πâ‡∏Ç‡∏≤‡∏ß (1 ‡∏Å‡πâ‡∏≠‡∏ô)', protein: 10, kcal: 90, icon: 'Box' },
            { name: '‡∏Å‡∏£‡∏µ‡∏Å‡πÇ‡∏¢‡πÄ‡∏Å‡∏¥‡∏£‡πå‡∏ï (1 ‡∏ñ‡πâ‡∏ß‡∏¢)', protein: 10, kcal: 60, icon: 'Milk' },
            { name: '‡∏ó‡∏π‡∏ô‡πà‡∏≤‡∏Å‡∏£‡∏∞‡∏õ‡πã‡∏≠‡∏á (‡∏Ñ‡∏£‡∏∂‡πà‡∏á)', protein: 16, kcal: 70, icon: 'FishSymbol' },
            { name: '‡∏ñ‡∏±‡πà‡∏ß‡πÅ‡∏£‡∏∞‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô', protein: 11, kcal: 120, icon: 'Bean' },
            { name: '‡∏Å‡∏∏‡πâ‡∏á‡∏•‡∏ß‡∏Å (10 ‡∏ï‡∏±‡∏ß)', protein: 20, kcal: 100, icon: 'Shell' },
            { name: '‡∏ô‡∏°‡∏ñ‡∏±‡πà‡∏ß‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á', protein: 8, kcal: 80, icon: 'GlassWater' },
            { name: '‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô‡πÄ‡∏ä‡∏Ñ (1.5 ‡∏™‡∏Å‡∏π‡πä‡∏õ)', protein: 30, kcal: 130, icon: 'CupSoda', highlight: true },
        ];

        // --- Sub-components ---

        const WelcomeStep = ({ setStep }) => (
            <div className="text-center space-y-6 py-8">
                <div className="flex justify-center mb-6">
                    <div className="bg-teal-100 p-4 rounded-full">
                        <Icon name="Activity" size={48} className="text-teal-600" />
                    </div>
                </div>
                <h1 className="text-3xl font-bold text-gray-800">‡πÄ‡∏ä‡πá‡∏Å‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ú‡∏≤‡∏ú‡∏•‡∏≤‡∏ç‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h1>
                <p className="text-gray-600 text-lg">
                    ‡∏£‡∏π‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‡πÅ‡∏ï‡πà "‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ú‡∏≤‡∏ú‡∏•‡∏≤‡∏ç" ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏∏‡∏ç‡πÅ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç <br/>
                    ‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô 1 ‡∏ô‡∏≤‡∏ó‡∏µ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•
                </p>
                <div className="flex flex-col gap-3 mt-8">
                    <button 
                        onClick={() => setStep(1)}
                        className="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-4 px-6 rounded-xl shadow-lg transform transition hover:-translate-y-1 flex items-center justify-center text-lg"
                    >
                        ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô <span className="ml-2"><Icon name="ArrowRight" size={20} /></span>
                    </button>
                    <p className="text-xs text-gray-400 mt-2">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ ‚Ä¢ ‡∏£‡∏π‡πâ‡∏ú‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
                </div>
            </div>
        );

        const BasicInfoStep = ({ formData, setFormData, handleInputChange, setStep }) => (
            <div className="space-y-6">
                <h2 className="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                    <span className="mr-2 text-teal-600"><Icon name="User" /></span> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢
                </h2>
                
                <div className="grid grid-cols-2 gap-4 mb-4">
                    <button 
                        onClick={() => setFormData(prev => ({...prev, gender: 'male'}))}
                        className={`p-4 rounded-xl border-2 flex flex-col items-center justify-center transition ${formData.gender === 'male' ? 'border-teal-500 bg-teal-50 text-teal-700' : 'border-gray-200 text-gray-500'}`}
                    >
                        <span className="text-2xl mb-1">üë®</span> ‡∏ä‡∏≤‡∏¢
                    </button>
                    <button 
                        onClick={() => setFormData(prev => ({...prev, gender: 'female'}))}
                        className={`p-4 rounded-xl border-2 flex flex-col items-center justify-center transition ${formData.gender === 'female' ? 'border-teal-500 bg-teal-50 text-teal-700' : 'border-gray-200 text-gray-500'}`}
                    >
                        <span className="text-2xl mb-1">üë©</span> ‡∏´‡∏ç‡∏¥‡∏á
                    </button>
                </div>

                <div className="space-y-4">
                    <div className="grid grid-cols-2 gap-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏õ‡∏µ)</label>
                            <input 
                                type="number" 
                                name="age"
                                value={formData.age}
                                onChange={handleInputChange}
                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:outline-none"
                                placeholder="‡πÄ‡∏ä‡πà‡∏ô 35"
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏≠‡∏ö‡πÄ‡∏≠‡∏ß (‡∏ô‡∏¥‡πâ‡∏ß)</label>
                            <div className="relative">
                                <input 
                                    type="number" 
                                    name="waist"
                                    value={formData.waist}
                                    onChange={handleInputChange}
                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:outline-none pl-10"
                                    placeholder="‡πÄ‡∏ä‡πà‡∏ô 32"
                                />
                                <div className="absolute left-3 top-3.5 text-gray-400"><Icon name="Ruler" size={20} /></div>
                            </div>
                            <p className="text-xs text-teal-600 mt-1">*‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏î‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ó‡πâ‡∏≠‡∏á</p>
                        </div>
                    </div>

                    <div className="grid grid-cols-2 gap-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (‡∏ã‡∏°.)</label>
                            <div className="relative">
                                <input 
                                    type="number" 
                                    name="height"
                                    value={formData.height}
                                    onChange={handleInputChange}
                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:outline-none pl-10"
                                    placeholder="165"
                                />
                                <div className="absolute left-3 top-3.5 text-gray-400"><Icon name="Ruler" size={20} /></div>
                            </div>
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (‡∏Å‡∏Å.)</label>
                            <div className="relative">
                                <input 
                                    type="number" 
                                    name="weight"
                                    value={formData.weight}
                                    onChange={handleInputChange}
                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:outline-none pl-10"
                                    placeholder="60"
                                />
                                <div className="absolute left-3 top-3.5 text-gray-400"><Icon name="Scale" size={20} /></div>
                            </div>
                        </div>
                    </div>
                </div>

                <button 
                    disabled={!formData.age || !formData.height || !formData.weight || !formData.waist}
                    onClick={() => setStep(2)}
                    className="w-full bg-teal-600 disabled:bg-gray-300 text-white font-bold py-3 rounded-xl mt-6 flex justify-center items-center"
                >
                    ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ <span className="ml-1"><Icon name="ArrowRight" size={20} /></span>
                </button>
            </div>
        );

        const ActivityStep = ({ formData, setFormData, setStep }) => (
            <div className="space-y-6">
                <h2 className="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                    <span className="mr-2 text-teal-600"><Icon name="Activity" /></span> ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
                </h2>
                <p className="text-gray-600 text-sm">‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏°‡∏µ‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏≠‡∏¥‡∏ô‡∏ã‡∏π‡∏•‡∏¥‡∏ô‡πÉ‡∏ô‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢</p>
                
                <div className="space-y-3">
                    {[
                        { id: 'sedentary', label: '‡∏ô‡∏±‡πà‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å', desc: '‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏ô‡πâ‡∏≠‡∏¢‡∏°‡∏≤‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏≠‡∏Å‡πÄ‡∏•‡∏¢' },
                        { id: 'light', label: '‡∏Ç‡∏¢‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏ö‡πâ‡∏≤‡∏á', desc: '‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡πÄ‡∏ö‡∏≤‡πÜ 1-3 ‡∏ß‡∏±‡∏ô/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå' },
                        { id: 'moderate', label: '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á', desc: '‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢ 3-5 ‡∏ß‡∏±‡∏ô/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå' },
                        { id: 'active', label: '‡πÅ‡∏≠‡∏Ñ‡∏ó‡∏µ‡∏ü‡∏°‡∏≤‡∏Å', desc: '‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏´‡∏ô‡∏±‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ä‡πâ‡πÅ‡∏£‡∏á‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô' }
                    ].map((option) => (
                        <button
                            key={option.id}
                            onClick={() => setFormData(prev => ({...prev, activity: option.id}))}
                            className={`w-full text-left p-4 rounded-xl border-2 transition hover:border-teal-300 ${formData.activity === option.id ? 'border-teal-500 bg-teal-50' : 'border-gray-200'}`}
                        >
                            <div className={`font-bold ${formData.activity === option.id ? 'text-teal-800' : 'text-gray-700'}`}>{option.label}</div>
                            <div className="text-sm text-gray-500">{option.desc}</div>
                        </button>
                    ))}
                </div>

                <div className="flex gap-3 mt-6">
                    <button onClick={() => setStep(1)} className="px-6 py-3 border border-gray-300 rounded-xl text-gray-600">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
                    <button onClick={() => setStep(3)} className="flex-1 bg-teal-600 text-white font-bold py-3 rounded-xl flex justify-center items-center">
                        ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ <span className="ml-1"><Icon name="ArrowRight" size={20} /></span>
                    </button>
                </div>
            </div>
        );

        const SymptomsStep = ({ formData, toggleSymptom, setStep, calculateResult }) => (
            <div className="space-y-6">
                <h2 className="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                    <span className="mr-2 text-teal-600"><Icon name="ClipboardList" /></span> ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏û‡∏ö (Metabolic Signs)
                </h2>
                <p className="text-gray-600 text-sm">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡πà‡∏≠‡∏¢‡πÜ (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1 ‡∏Ç‡πâ‡∏≠)</p>
                
                <div className="grid grid-cols-1 gap-3">
                    {[
                        { id: 'craving', label: '‡∏´‡∏¥‡∏ß‡∏ö‡πà‡∏≠‡∏¢ / ‡∏ï‡∏¥‡∏î‡∏´‡∏ß‡∏≤‡∏ô', iconName: 'Utensils' },
                        { id: 'hangry', label: '‡πÇ‡∏°‡πÇ‡∏´‡∏´‡∏¥‡∏ß (Hangry) ‡∏á‡πà‡∏≤‡∏¢', iconName: 'AlertCircle' },
                        { id: 'fatigue', label: '‡∏á‡πà‡∏ß‡∏á‡∏ô‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏°‡∏∑‡πâ‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£', iconName: 'Battery' },
                        { id: 'yo-yo', label: '‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡∏á‡πà‡∏≤‡∏¢ ‡∏•‡∏á‡∏¢‡∏≤‡∏Å', iconName: 'Scale' },
                        { id: 'stress', label: '‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î‡∏á‡πà‡∏≤‡∏¢ / ‡∏ô‡∏≠‡∏ô‡πÑ‡∏°‡πà‡∏´‡∏•‡∏±‡∏ö', iconName: 'Activity' },
                        { id: 'none', label: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≤‡∏á‡∏ï‡πâ‡∏ô', iconName: 'CheckCircle' }
                    ].map((item) => (
                        <button
                            key={item.id}
                            onClick={() => toggleSymptom(item.id)}
                            className={`flex items-center p-4 rounded-xl border-2 transition ${formData.symptoms.includes(item.id) ? 'border-teal-500 bg-teal-50 text-teal-800' : 'border-gray-200 text-gray-600'}`}
                        >
                            <div className={`mr-3 p-2 rounded-full ${formData.symptoms.includes(item.id) ? 'bg-teal-200' : 'bg-gray-100'}`}>
                                <Icon name={item.iconName} size={16} />
                            </div>
                            {item.label}
                        </button>
                    ))}
                </div>

                <div className="flex gap-3 mt-6">
                    <button onClick={() => setStep(2)} className="px-6 py-3 border border-gray-300 rounded-xl text-gray-600">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
                    <button onClick={calculateResult} className="flex-1 bg-teal-600 text-white font-bold py-3 rounded-xl shadow-lg flex justify-center items-center">
                        ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• <span className="ml-2 animate-pulse"><Icon name="Activity" size={20} /></span>
                    </button>
                </div>
            </div>
        );

        const ResultStep = ({ result, formData, setStep }) => {
            const [showFact, setShowFact] = useState(false);
            const [showSnackCheck, setShowSnackCheck] = useState(false);
            const [currentSnacks, setCurrentSnacks] = useState([]);
            const [showProteinCheck, setShowProteinCheck] = useState(false);
            const [currentProteins, setCurrentProteins] = useState([]);
            const [proteinGoal, setProteinGoal] = useState(0);

            const isHealthy = result.bmi >= 18.5 && result.bmi < 23 && result.whtrStatus === 'normal';

            // Calculate Gauge Position
            const getGaugePosition = (bmi) => {
                if (bmi < 18.5) return (bmi / 18.5) * 18.5;
                if (bmi < 23) return 18.5 + ((bmi - 18.5) / (23 - 18.5)) * 13.5;
                if (bmi < 25) return 32 + ((bmi - 23) / (25 - 23)) * 11;
                if (bmi < 30) return 43 + ((bmi - 25) / (30 - 25)) * 20;
                const cappedBmi = Math.min(bmi, 40);
                return 63 + ((cappedBmi - 30) / (40 - 30)) * 37;
            };

            const gaugePosition = getGaugePosition(parseFloat(result.bmi));

            const getRandomItems = (array, count) => {
                const shuffled = [...array].sort(() => 0.5 - Math.random());
                return shuffled.slice(0, count);
            };

            const handleSnackCheck = () => {
                if (!showSnackCheck) {
                    const db = isHealthy ? HEALTHY_SNACK_DATABASE : SNACK_DATABASE;
                    setCurrentSnacks(getRandomItems(db, 3));
                }
                setShowSnackCheck(!showSnackCheck);
            };

            const shuffleSnacks = () => {
                const db = isHealthy ? HEALTHY_SNACK_DATABASE : SNACK_DATABASE;
                setCurrentSnacks(getRandomItems(db, 3));
            };

            const handleProteinCheck = () => {
                if (!showProteinCheck) {
                    const shake = PROTEIN_DATABASE.find(p => p.highlight);
                    const others = PROTEIN_DATABASE.filter(p => !p.highlight);
                    const randomOthers = getRandomItems(others, 2);
                    const mix = [...randomOthers, shake].sort(() => 0.5 - Math.random());
                    
                    const multiplier = isHealthy ? 1.8 : 1.5;
                    setProteinGoal(Math.round(parseFloat(formData.weight) * multiplier)); 
                    setCurrentProteins(mix);
                }
                setShowProteinCheck(!showProteinCheck);
            };

            const shuffleProtein = () => {
                const shake = PROTEIN_DATABASE.find(p => p.highlight);
                const others = PROTEIN_DATABASE.filter(p => !p.highlight);
                const randomOthers = getRandomItems(others, 2);
                const mix = [...randomOthers, shake].sort(() => 0.5 - Math.random());
                setCurrentProteins(mix);
            };

            return (
                <div className="space-y-6 animate-fade-in">
                    {/* --- Section 1: Health Score --- */}
                    <div className="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                        <div className="bg-gray-50 p-4 border-b border-gray-100 text-center">
                            <h3 className="text-gray-500 text-sm uppercase tracking-wider font-semibold">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢</h3>
                            
                            <div className="grid grid-cols-2 gap-4 mt-4">
                                <div className="bg-white p-3 rounded-xl border border-gray-200">
                                    <span className="text-xs text-gray-400 block mb-1">BMI Value</span>
                                    <span className={`text-2xl font-bold ${result.category.color}`}>{result.bmi}</span>
                                    <div className="text-xs text-gray-500">{result.category.label}</div>
                                </div>
                                
                                <div className="bg-white p-3 rounded-xl border border-gray-200 relative">
                                    <div className="absolute top-2 right-2 cursor-pointer" onClick={() => setShowFact(!showFact)}>
                                        <Icon name="Info" size={16} className="text-gray-400 hover:text-teal-500" />
                                    </div>
                                    <span className="text-xs text-gray-400 block mb-1">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏≠‡∏ß/‡∏™‡∏π‡∏á</span>
                                    <span className={`text-2xl font-bold ${result.whtrStatus === 'risk' ? 'text-red-500' : 'text-green-500'}`}>
                                        {result.whtr}
                                    </span>
                                    <div className="text-xs text-gray-500">
                                        {result.whtrStatus === 'risk' ? '‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ó‡πâ‡∏≠‡∏á‡∏™‡∏π‡∏á' : '‡∏™‡∏°‡∏™‡πà‡∏ß‡∏ô'}
                                    </div>
                                </div>
                            </div>
                            
                            {showFact && (
                                <div className="mt-3 bg-blue-50 text-blue-800 text-xs text-left p-3 rounded-lg border border-blue-100">
                                    <strong>Did you know?</strong> ‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤ "‡∏£‡∏≠‡∏ö‡πÄ‡∏≠‡∏ß‡∏´‡∏≤‡∏£‡∏î‡πâ‡∏ß‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á" (WHtR) ‡∏ö‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÇ‡∏£‡∏Ñ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏Å‡∏ß‡πà‡∏≤ BMI ‡πÇ‡∏î‡∏¢‡∏Ñ‡πà‡∏≤‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡∏¥‡∏ô 0.5
                                </div>
                            )}
                        </div>

                        {/* Visual Gauge */}
                        <div className="px-6 py-4">
                            <div className="relative pt-6 pb-2">
                                <div className="h-4 bg-gray-200 rounded-full overflow-hidden flex">
                                    <div className="w-[18.5%] bg-blue-300"></div> 
                                    <div className="w-[13.5%] bg-green-400"></div> 
                                    <div className="w-[11%] bg-yellow-400"></div> 
                                    <div className="w-[20%] bg-orange-400"></div> 
                                    <div className="w-[37%] bg-red-400"></div>   
                                </div>
                                <div 
                                    className="absolute top-0 transform -translate-x-1/2 transition-all duration-1000"
                                    style={{ left: `${gaugePosition}%` }}
                                >
                                    <div className="w-0 h-0 border-l-[8px] border-l-transparent border-r-[8px] border-r-transparent border-t-[10px] border-t-gray-800 mx-auto mb-1"></div>
                                    <div className="bg-gray-800 text-white text-xs py-0.5 px-2 rounded-md font-bold text-center w-max mx-auto -mt-1">‡∏Ñ‡∏∏‡∏ì</div>
                                </div>
                            </div>
                            <div className="flex justify-between text-[10px] text-gray-400 mt-1 font-mono">
                                <span className="w-[18.5%] text-right pr-1">18.5</span>
                                <span className="w-[13.5%] text-right pr-1">23</span>
                                <span className="w-[11%] text-right pr-1">25</span>
                                <span className="w-[20%] text-right pr-1">30</span>
                                <span className="w-[37%]"></span>
                            </div>
                            
                            {result.whtrStatus === 'risk' ? (
                                <div className="mt-4 bg-red-50 border border-red-100 rounded-lg p-3 flex items-start">
                                    <div className="mr-2 mt-0.5 text-red-500"><Icon name="AlertCircle" size={20} /></div>
                                    <div>
                                        <p className="text-sm font-bold text-red-700">‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏†‡∏≤‡∏ß‡∏∞ "Skinny Fat" (‡∏≠‡πâ‡∏ß‡∏ô‡∏•‡∏á‡∏û‡∏∏‡∏á)</p>
                                        <p className="text-xs text-red-600 mt-1">‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ó‡πâ‡∏≠‡∏á‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏Å‡∏ì‡∏ë‡πå ‡∏Ç‡∏±‡∏î‡∏Ç‡∏ß‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ú‡∏≤‡∏ú‡∏•‡∏≤‡∏ç</p>
                                    </div>
                                </div>
                            ) : (
                                <div className="mt-4 bg-green-50 border border-green-100 rounded-lg p-3 flex items-start">
                                    <div className="mr-2 mt-0.5 text-green-500"><Icon name="CheckCircle" size={20} /></div>
                                    <div>
                                        <p className="text-sm font-bold text-green-700">‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°! ‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á‡∏™‡∏°‡∏™‡πà‡∏ß‡∏ô</p>
                                        <p className="text-xs text-green-600 mt-1">‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡πÅ‡∏Å‡πà‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö Metabolic Flexibility</p>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* --- Ideal Weight Range --- */}
                        <div className="px-6 pb-6 pt-0">
                            <div className="bg-teal-50 rounded-xl p-4 border border-teal-100 text-center">
                                <p className="text-sm text-gray-500 mb-1">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì (BMI 18.5 - 22.9)</p>
                                <div className="text-2xl font-bold text-teal-700 flex items-center justify-center gap-2">
                                    <Icon name="Scale" size={24} />
                                    {result.minIdealWeight} - {result.maxIdealWeight} <span className="text-base font-normal text-gray-600">‡∏Å‡∏Å.</span>
                                </div>
                                <p className="text-xs text-teal-600 mt-2">
                                    {parseFloat(formData.weight) > parseFloat(result.maxIdealWeight) 
                                        ? `‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡∏•‡∏î‡∏≠‡∏µ‡∏Å ${(parseFloat(formData.weight) - parseFloat(result.maxIdealWeight)).toFixed(1)} ‡∏Å‡∏Å. ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏õ‡∏Å‡∏ï‡∏¥`
                                        : parseFloat(formData.weight) < parseFloat(result.minIdealWeight)
                                            ? `‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡∏Å ${(parseFloat(result.minIdealWeight) - parseFloat(formData.weight)).toFixed(1)} ‡∏Å‡∏Å. ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á`
                                            : "‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ!"
                                    }
                                </p>
                            </div>
                        </div>
                    </div>

                    {/* --- Section 2: 5 Steps Solution --- */}
                    <div className="space-y-3">
                        <h4 className={`font-bold ${isHealthy ? 'text-teal-700' : 'text-gray-800'} flex items-center text-lg`}>
                            <span className="mr-2"><Icon name={isHealthy ? "Zap" : "CheckCircle"} size={20} /></span>
                            {isHealthy ? '5 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î‡∏£‡πà‡∏≤‡∏á‡∏ó‡∏≠‡∏á (Optimization)' : '5 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ú‡∏≤‡∏ú‡∏•‡∏≤‡∏ç'}
                        </h4>
                        <p className="text-sm text-gray-500 -mt-2 mb-4">
                            {isHealthy ? '‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô' : '‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏î‡∏≠‡∏≤‡∏´‡∏≤‡∏£'}
                        </p>

                        {/* Step 1 */}
                        <div className={`bg-white border-l-4 ${isHealthy ? 'border-blue-500' : 'border-teal-500'} rounded-r-xl shadow-sm overflow-hidden`}>
                            <div className="p-4">
                                <h5 className="font-bold text-gray-800 flex justify-between">
                                    {isHealthy ? '1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ä‡∏∞‡∏•‡∏≠‡∏ß‡∏±‡∏¢' : '1. ‡∏´‡∏¢‡∏∏‡∏î "‡∏à‡∏∏‡∏ö‡∏à‡∏¥‡∏ö" ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ'}
                                    <span className={`text-xs font-bold ${isHealthy ? 'bg-blue-100 text-blue-700' : 'bg-teal-100 text-teal-700'} px-2 py-1 rounded h-fit`}>‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</span>
                                </h5>
                                <p className="text-sm text-gray-600 mt-1 mb-3">
                                    {isHealthy 
                                    ? '‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô Superfood ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡πâ‡∏≤‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏π‡∏•‡∏≠‡∏¥‡∏™‡∏£‡∏∞' 
                                    : '‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏ô‡∏ö‡πà‡∏≠‡∏¢‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡∏≠‡∏¥‡∏ô‡∏ã‡∏π‡∏•‡∏¥‡∏ô‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏î‡∏∂‡∏á‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏°‡∏≤‡πÉ‡∏ä‡πâ'}
                                </p>
                                
                                <button 
                                    onClick={handleSnackCheck}
                                    className={`text-sm border px-3 py-1.5 rounded-lg w-full flex items-center justify-center transition ${isHealthy ? 'bg-green-50 text-green-600 border-green-100 hover:bg-green-100' : 'bg-red-50 text-red-600 border-red-100 hover:bg-red-100'}`}
                                >
                                    <span className="mr-2"><Icon name={isHealthy ? "CheckCircle" : "XCircle"} size={16} /></span>
                                    {showSnackCheck ? '‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£' : (isHealthy ? '‡∏î‡∏π‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏Ç‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û' : '‡∏î‡∏π‡πÄ‡∏°‡∏ô‡∏π‡∏à‡∏∏‡∏ö‡∏à‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á')}
                                </button>
                                
                                {showSnackCheck && (
                                    <div className={`mt-3 p-3 rounded-xl border animate-fade-in ${isHealthy ? 'bg-green-50/50 border-green-100' : 'bg-red-50/50 border-red-100'}`}>
                                        <div className="flex justify-between items-center mb-2">
                                            <span className={`text-xs font-bold uppercase tracking-wide ${isHealthy ? 'text-green-500' : 'text-red-500'}`}>
                                                {isHealthy ? '‡∏Ç‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥' : '‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏°‡∏ô‡∏π‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏ù‡∏á'}
                                            </span>
                                            <button onClick={shuffleSnacks} className="text-gray-400 hover:text-gray-600">
                                                <Icon name="RefreshCw" size={16} />
                                            </button>
                                        </div>
                                        <div className="space-y-2">
                                            {currentSnacks.map((snack, idx) => (
                                                <div key={idx} className={`bg-white p-2 rounded-lg border flex justify-between items-center shadow-sm ${isHealthy ? 'border-green-100' : 'border-red-100'}`}>
                                                    <div className="flex items-center">
                                                        <span className="mr-2 text-gray-500"><Icon name={snack.icon} size={20} /></span>
                                                        <div>
                                                            <p className="text-sm font-bold text-gray-800">{snack.name}</p>
                                                            <p className="text-[10px] text-gray-500">
                                                                C:{snack.c} F:{snack.f} P:{snack.p}
                                                            </p>
                                                        </div>
                                                    </div>
                                                    <span className={`text-sm font-bold ${isHealthy ? 'text-green-600' : 'text-red-500'}`}>{snack.kcal} <span className="text-[10px] font-normal text-gray-400">kcal</span></span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Step 2 */}
                        <div className={`bg-white border-l-4 ${isHealthy ? 'border-blue-500' : 'border-teal-500'} rounded-r-xl shadow-sm overflow-hidden`}>
                            <div className="p-4">
                                <h5 className="font-bold text-gray-800 flex justify-between">
                                    {isHealthy ? '2. ‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠' : '2. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡πÅ‡∏£‡∏Å'}
                                    <span className={`text-xs font-bold ${isHealthy ? 'bg-blue-100 text-blue-700' : 'bg-teal-100 text-teal-700'} px-2 py-1 rounded h-fit`}>‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</span>
                                </h5>
                                <p className="text-sm text-gray-600 mt-1 mb-3">
                                    {isHealthy 
                                    ? '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏°‡∏ß‡∏•‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ú‡∏≤‡∏ú‡∏•‡∏≤‡∏ç‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (BMR)' 
                                    : '‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏£‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ú‡∏≤‡∏ú‡∏•‡∏≤‡∏ç‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∏‡∏°‡∏´‡∏¥‡∏ß‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î'}
                                </p>

                                <button 
                                    onClick={handleProteinCheck}
                                    className="text-sm bg-blue-50 text-blue-600 border border-blue-100 px-3 py-1.5 rounded-lg w-full flex items-center justify-center hover:bg-blue-100 transition"
                                >
                                    <span className="mr-2"><Icon name="Dumbbell" size={16} /></span>
                                    {showProteinCheck ? '‡∏ã‡πà‡∏≠‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì' : '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö'}
                                </button>

                                {showProteinCheck && (
                                    <div className="mt-3 bg-blue-50/50 p-3 rounded-xl border border-blue-100 animate-fade-in">
                                        <div className="flex items-center justify-between mb-3 bg-white p-2 rounded-lg border border-blue-100 shadow-sm">
                                            <span className="text-xs text-gray-500">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</span>
                                            <div className="text-right">
                                                <span className="text-lg font-bold text-blue-600">{proteinGoal}g</span>
                                                <span className="text-[10px] text-gray-400 block -mt-1">{isHealthy ? '‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠/‡∏ß‡∏±‡∏ô' : '‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô/‡∏ß‡∏±‡∏ô'}</span>
                                            </div>
                                        </div>

                                        <div className="flex justify-between items-center mb-2">
                                            <span className="text-xs font-bold text-blue-500 uppercase tracking-wide">‡πÅ‡∏´‡∏•‡πà‡∏á‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</span>
                                            <button onClick={shuffleProtein} className="text-gray-400 hover:text-gray-600">
                                                <Icon name="RefreshCw" size={16} />
                                            </button>
                                        </div>
                                        
                                        <div className="space-y-2">
                                            {currentProteins.map((item, idx) => (
                                                <div key={idx} className={`bg-white p-2 rounded-lg border flex justify-between items-center shadow-sm ${item.highlight ? 'border-teal-300 ring-1 ring-teal-100' : 'border-blue-100'}`}>
                                                    <div className="flex items-center">
                                                        <span className="mr-2 text-gray-500"><Icon name={item.icon} size={20} /></span>
                                                        <div>
                                                            <p className={`text-sm font-bold ${item.highlight ? 'text-teal-700' : 'text-gray-800'}`}>{item.name}</p>
                                                            <p className="text-[10px] text-gray-500">{item.kcal} kcal</p>
                                                        </div>
                                                    </div>
                                                    <div className="text-right">
                                                        <span className={`text-sm font-bold ${item.highlight ? 'text-teal-600' : 'text-blue-600'}`}>{item.protein}g</span>
                                                        <span className="text-[10px] font-normal text-gray-400 block -mt-1">‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô</span>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Locked Steps Overlay */}
                        <div className="relative">
                            <div className="opacity-50 blur-sm pointer-events-none space-y-3 select-none">
                                <div className="bg-gray-100 p-4 rounded-xl border border-gray-200">
                                    <h5 className="font-bold text-gray-500">3. {isHealthy ? '‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ Autophagy ‡∏ä‡∏∞‡∏•‡∏≠‡∏ß‡∏±‡∏¢' : '‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ IF ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏°‡∏≤‡∏ô'}</h5>
                                    <p className="text-sm text-gray-400">xxxxxx xxxxxxxx xxxxxxx</p>
                                </div>
                                <div className="bg-gray-100 p-4 rounded-xl border border-gray-200">
                                    <h5 className="font-bold text-gray-500">4. {isHealthy ? 'Zone 2 Training ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏∂‡∏î' : '‡πÇ‡∏ã‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏™‡∏•‡∏≤‡∏¢‡∏û‡∏∏‡∏á'}</h5>
                                    <p className="text-sm text-gray-400">xxxxxx xxxxxxxx xxxxxxx</p>
                                </div>
                                <div className="bg-gray-100 p-4 rounded-xl border border-gray-200">
                                    <h5 className="font-bold text-gray-500">5. {isHealthy ? 'Deep Sleep & Growth Hormone' : '‡∏Å‡∏≤‡∏£‡∏ô‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠ Metabolic Reset'}</h5>
                                    <p className="text-sm text-gray-400">xxxxxx xxxxxxxx xxxxxxx</p>
                                </div>
                            </div>

                            <div className="absolute inset-0 flex flex-col items-center justify-center z-10 -mt-6">
                                <div className="bg-white/90 backdrop-blur-sm p-6 rounded-2xl shadow-lg border border-teal-100 text-center max-w-xs mx-auto">
                                    <div className="bg-orange-100 p-3 rounded-full inline-block mb-3">
                                        <Icon name="Lock" size={32} className="text-orange-500" />
                                    </div>
                                    <h4 className="font-bold text-gray-800 text-lg mb-1">‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å 3 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠</h4>
                                    <p className="text-sm text-gray-500 mb-2">
                                        + <span className="text-teal-600 font-bold"><Icon name="Gift" size={12} className="inline mr-1"/> Bonus: ‡∏™‡∏π‡∏ï‡∏£‡∏•‡∏±‡∏ö UP Labs</span><br/>
                                        ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (Personalized)
                                    </p>
                                    <button 
                                        onClick={() => setStep(5)}
                                        className="w-full bg-gradient-to-r from-orange-500 to-red-500 text-white font-bold py-3 px-6 rounded-xl shadow-md hover:shadow-lg transform transition hover:scale-105 flex items-center justify-center"
                                    >
                                        <span className="mr-2"><Icon name="Unlock" size={16} /></span> ‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ü‡∏£‡∏µ
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const LeadFormStep = ({ leadInfo, setLeadInfo, handleLeadSubmit, setStep }) => (
            <div className="space-y-6">
                <div className="text-center mb-6">
                    <div className="bg-teal-100 p-4 rounded-full inline-block mb-4">
                        <Icon name="Unlock" size={40} className="text-teal-600" />
                    </div>
                    <h2 className="text-2xl font-bold text-gray-800">‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!</h2>
                    <p className="text-gray-600">
                        ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö <strong>"3 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ + ‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏™‡∏π‡∏ï‡∏£‡∏•‡∏±‡∏ö"</strong> <br/>
                        ‡∏™‡πà‡∏á‡∏ï‡∏£‡∏á‡∏ñ‡∏∂‡∏á‡∏°‡∏∑‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏ü‡∏£‡∏µ ‡∏ó‡∏≤‡∏á‡πÑ‡∏•‡∏ô‡πå/SMS
                    </p>
                </div>

                <form onSubmit={handleLeadSubmit} className="space-y-4">
                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                        <div className="relative">
                            <input 
                                required
                                type="text" 
                                className="w-full p-3 border border-gray-300 rounded-lg pl-10 focus:ring-2 focus:ring-teal-500 focus:outline-none"
                                placeholder="‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏£‡∏±‡∏Å‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û"
                                value={leadInfo.name}
                                onChange={(e) => setLeadInfo(prev => ({...prev, name: e.target.value}))}
                            />
                            <div className="absolute left-3 top-3.5 text-gray-400"><Icon name="User" size={20} /></div>
                        </div>
                    </div>
                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö SMS)</label>
                        <div className="relative">
                            <input 
                                required
                                type="tel" 
                                className="w-full p-3 border border-gray-300 rounded-lg pl-10 focus:ring-2 focus:ring-teal-500 focus:outline-none"
                                placeholder="081-234-5678"
                                value={leadInfo.phone}
                                onChange={(e) => setLeadInfo(prev => ({...prev, phone: e.target.value}))}
                            />
                            <div className="absolute left-3 top-3.5 text-gray-400"><Icon name="Phone" size={20} /></div>
                        </div>
                    </div>
                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">Line ID (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏™‡∏π‡∏ï‡∏£‡∏•‡∏±‡∏ö‡∏â‡∏ö‡∏±‡∏ö‡πÄ‡∏ï‡πá‡∏°)</label>
                        <div className="relative">
                            <input 
                                type="text" 
                                className="w-full p-3 border border-gray-300 rounded-lg pl-10 focus:ring-2 focus:ring-teal-500 focus:outline-none"
                                placeholder="@lineid"
                                value={leadInfo.lineId}
                                onChange={(e) => setLeadInfo(prev => ({...prev, lineId: e.target.value}))}
                            />
                            <div className="absolute left-3 top-3.5 text-gray-400"><Icon name="MessageSquare" size={20} /></div>
                        </div>
                    </div>

                    <button 
                        type="submit"
                        className="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-4 rounded-xl shadow-lg mt-6 transition-colors"
                    >
                        ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡∏ï‡∏£‡∏•‡∏±‡∏ö‡∏ü‡∏£‡∏µ
                    </button>
                </form>
                
                <button onClick={() => setStep(4)} className="w-full text-center text-gray-500 text-sm mt-4">
                    ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏î‡∏π‡∏ú‡∏• BMI
                </button>
            </div>
        );

        const ThankYouStep = ({ leadInfo }) => (
            <div className="text-center py-10 space-y-6">
                <div className="bg-green-100 p-6 rounded-full inline-block mb-4">
                    <Icon name="CheckCircle" size={80} className="text-green-600" />
                </div>
                <h2 className="text-3xl font-bold text-gray-800">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h2>
                <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100 max-w-sm mx-auto">
                    <p className="text-gray-600 mb-2">‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á <strong>"5 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô + ‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏™‡∏π‡∏ï‡∏£‡∏•‡∏±‡∏ö"</strong> ‡πÑ‡∏õ‡∏ó‡∏µ‡πà:</p>
                    <div className="space-y-1 mt-4">
                        <p className="font-bold text-lg text-teal-700">{leadInfo.name}</p>
                        <p className="text-gray-800 flex items-center justify-center gap-2">
                            <Icon name="MessageSquare" size={16} /> {leadInfo.lineId || '-'}
                        </p>
                        <p className="text-gray-800 flex items-center justify-center gap-2">
                            <Icon name="Phone" size={16} /> {leadInfo.phone}
                        </p>
                    </div>
                </div>
                <p className="text-sm text-gray-500 mt-8 px-4">
                    "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Ñ‡∏∑‡∏≠‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏°‡∏µ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ï‡∏•‡∏≠‡∏î‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï"
                </p>
                <button 
                    onClick={() => window.location.reload()}
                    className="text-teal-600 font-semibold underline mt-4"
                >
                    ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
                </button>
            </div>
        );

        // --- Main Component ---
        function MetabolicHealthCheck() {
            const [step, setStep] = useState(0);
            const [loading, setLoading] = useState(false);
            const [formData, setFormData] = useState({
                gender: 'female',
                age: '',
                height: '',
                weight: '',
                waist: '',
                activity: 'sedentary',
                symptoms: []
            });
            const [result, setResult] = useState(null);
            const [leadInfo, setLeadInfo] = useState({
                name: '',
                phone: '',
                lineId: ''
            });
            const [submitted, setSubmitted] = useState(false);

            const getBMICategory = (bmi) => {
                if (bmi < 18.5) return { label: '‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ', color: 'text-blue-500', bg: 'bg-blue-500', advice: '‡∏Ñ‡∏ß‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á‡∏Ç‡∏≠‡∏á‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠' };
                if (bmi < 23) return { label: '‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏™‡∏°‡∏™‡πà‡∏ß‡∏ô)', color: 'text-green-500', bg: 'bg-green-500', advice: '‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ú‡∏≤‡∏ú‡∏•‡∏≤‡∏ç‡∏ó‡∏µ‡πà‡∏î‡∏µ' };
                if (bmi < 25) return { label: '‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô (‡∏ó‡πâ‡∏ß‡∏°)', color: 'text-yellow-500', bg: 'bg-yellow-500', advice: '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á ‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏™‡∏∞‡∏™‡∏°' };
                if (bmi < 30) return { label: '‡∏≠‡πâ‡∏ß‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö 1', color: 'text-orange-500', bg: 'bg-orange-500', advice: '‡∏Ñ‡∏ß‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ú‡∏≤‡∏ú‡∏•‡∏≤‡∏ç‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏±‡∏á' };
                return { label: '‡∏≠‡πâ‡∏ß‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö 2 (‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢)', color: 'text-red-500', bg: 'bg-red-500', advice: '‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≠‡πÇ‡∏£‡∏Ñ‡πÄ‡∏£‡∏∑‡πâ‡∏≠‡∏£‡∏±‡∏á‡∏™‡∏π‡∏á ‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏ó‡∏±‡∏ô‡∏ó‡∏µ' };
            };

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };

            const toggleSymptom = (symptom) => {
                setFormData(prev => {
                    const exists = prev.symptoms.includes(symptom);
                    return {
                        ...prev,
                        symptoms: exists 
                        ? prev.symptoms.filter(s => s !== symptom)
                        : [...prev.symptoms, symptom]
                    };
                });
            };

            const calculateResult = () => {
                setLoading(true);
                setTimeout(() => {
                    const heightM = parseFloat(formData.height) / 100;
                    const weightKg = parseFloat(formData.weight);
                    const waistInches = parseFloat(formData.waist);
                    const waistCm = waistInches * 2.54;
                    const heightCm = parseFloat(formData.height);
                    
                    const bmi = weightKg / (heightM * heightM);
                    
                    // BMI Asian Standard for Normal: 18.5 - 22.9
                    const minIdealWeight = 18.5 * (heightM * heightM);
                    const maxIdealWeight = 22.9 * (heightM * heightM);

                    const idealWeight = 22 * (heightM * heightM); // Target 22
                    const diff = weightKg - idealWeight;
                    
                    const whtr = waistCm / heightCm;
                    const whtrStatus = whtr > 0.5 ? 'risk' : 'normal';

                    setResult({
                        bmi: bmi.toFixed(1),
                        idealWeight: idealWeight.toFixed(1),
                        minIdealWeight: minIdealWeight.toFixed(1),
                        maxIdealWeight: maxIdealWeight.toFixed(1),
                        diff: diff.toFixed(1),
                        category: getBMICategory(bmi),
                        whtr: whtr.toFixed(2),
                        whtrStatus: whtrStatus
                    });
                    setLoading(false);
                    setStep(4);
                }, 1500);
            };

            // --- Supabase Logic ---
            const saveToSupabase = async (contactData) => {
                try {
                    if (dbClient) {
                        const { data: dbData, error } = await dbClient
                            .from('leads')
                            .insert([
                                {
                                    name: contactData.name,
                                    phone: contactData.phone,
                                    line_id: contactData.lineId,
                                    bmi: result?.bmi, 
                                    whtr: result?.whtr,
                                    created_at: new Date()
                                },
                            ]);
                        
                        if (error) {
                            console.error('Supabase Error:', error);
                        } else {
                            console.log("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
                        }
                    } else {
                        console.warn("Supabase client not available/initialized.");
                    }
                } catch (err) {
                    console.error("Save error:", err);
                }
            };

            const handleLeadSubmit = (e) => {
                e.preventDefault();
                saveToSupabase(leadInfo);
                setSubmitted(true);
            };

            return (
                <div className="min-h-screen bg-gray-50 flex items-center justify-center p-4 font-sans">
                    <div className="max-w-md w-full bg-white rounded-3xl shadow-xl overflow-hidden relative">
                        {step > 0 && step < 6 && !submitted && (
                            <div className="h-2 bg-gray-100">
                                <div 
                                    className="h-full bg-teal-500 transition-all duration-500 ease-out"
                                    style={{ width: `${(step / 5) * 100}%` }}
                                ></div>
                            </div>
                        )}

                        <div className="p-6 md:p-8">
                            {loading ? (
                                <div className="text-center py-20">
                                    <div className="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-teal-500 mx-auto mb-4"></div>
                                    <h3 className="text-xl font-bold text-gray-700">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</h3>
                                    <p className="text-gray-500">‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ñ‡πà‡∏≤ BMI ‡πÅ‡∏•‡∏∞‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ó‡πâ‡∏≠‡∏á (Visceral Fat)</p>
                                </div>
                            ) : (
                                <>
                                    {step === 0 && <WelcomeStep setStep={setStep} />}
                                    {step === 1 && <BasicInfoStep formData={formData} setFormData={setFormData} handleInputChange={handleInputChange} setStep={setStep} />}
                                    {step === 2 && <ActivityStep formData={formData} setFormData={setFormData} setStep={setStep} />}
                                    {step === 3 && <SymptomsStep formData={formData} toggleSymptom={toggleSymptom} setStep={setStep} calculateResult={calculateResult} />}
                                    {step === 4 && result && <ResultStep result={result} formData={formData} setStep={setStep} />}
                                    {step === 5 && !submitted && <LeadFormStep leadInfo={leadInfo} setLeadInfo={setLeadInfo} handleLeadSubmit={handleLeadSubmit} setStep={setStep} />}
                                    {submitted && <ThankYouStep leadInfo={leadInfo} />}
                                </>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MetabolicHealthCheck />);
    </script>
</body>
</html>
